"use strict";!function(){var nw=angular.module(regdep("nw-type"),[]);nw.directive("nwType",function(funcs){return{restrict:"A",require:"ngModel",link:function($scope,$element,$attrs,$model){function change(value){function getLangKey(type){var key;return"maskv4"==type||"maskv6"==type?"msg_invalid_mask":"hostv6"==type?"msg_invalid_host":"psk"==type?"wifi_invalid_psk":"notCyrillicChar"==type||"ipv4AddressOrSubnet"==type||"pppPassword"==type?(key=type.replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase(),"msg_invalid_"+key):"ipv6Addr"==type?"msg_invalid_ipv6":"msg_invalid_"+type}var result,validator=validators[$attrs.nwType];return validator&&(_.isUndefined(value)||!value.toString().length||$attrs.disabled?$model.$setValidity(getLangKey($attrs.nwType),!0):(result=validator(value),$model.$setValidity(getLangKey($attrs.nwType),result))),"number"==$attrs.nwType&&(value=parseInt(value)),value}var posInteger=function(value){var patt=/^[0-9]$|^[1-9][0-9]*$/;return patt.test(value)?!0:!1},isIpv4=function(value){var patt=/^(0|[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.(0|[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.(0|[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])\.(0|[1-9]?\d|1\d\d|2[0-4]\d|25[0-5])$/;return patt.test(value)?!0:!1},checkMask=function(mask,version){var endrange,bits,i,octet,flagmask,j,arr=mask.split("."),len=arr.length;switch(len){case 1:if(endrange="4"==version?32:128,!checkMaskRange(arr[0],0,endrange))return!1;break;case 4:if(!isIpv4(mask)||"4"!=version&&"46"!=version)return!1;for(bits="",i=0;4>i;i++){if(!posInteger(arr[i]))return!1;octet=parseInt(arr[i]),bits+=0==octet?"00000000":octet.toString(2)}if(32!=bits.length)return!1;for(flagmask="1"==bits.charAt(0)?!1:!0,j=1;j<=bits.length;j++)if(0==bits.charAt(j)&&(flagmask=!0),1==bits.charAt(j)&&flagmask)return!1;break;default:return!1}return!0},checkMaskRange=function(val,start_range,end_range){return!_.isNaN(parseInt(val))&&posInteger(val)?parseInt(val)<start_range||parseInt(val)>end_range?!1:!0:!1},validators={ip:function(value){return validators.ipv4(value)||validators.ipv6(value)},ipv4AddressOrSubnet:function(value){return funcs.is.ipv4(value)||funcs.is.ipv4Network(value)},ipv4:function(value){return isIpv4(value)},ipv6:function(value){var arrValue,patt=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;return _.isString(value)?(arrValue=value.split("/"),arrValue.length<=2&&(_.isUndefined(arrValue[0])||patt.test(arrValue[0]))&&(_.isUndefined(arrValue[1])||checkMask(arrValue[1],"6"))?!0:!1):!1},ipv6Addr:function(value){return funcs.is.ipv6(value)||!funcs.is.ipv6Network(value)},mask:function(value){return checkMask(value,"46")},maskv4:function(value){return checkMask(value,"4")},maskv6:function(value){return checkMask(value,"6")},prefixv6:function(value){if(_.isUndefined(value))return!1;var prefixInt=parseInt(value);return prefixInt>=0&&128>=prefixInt},number:function(value){var patt_number=/(^-?[0-9]+$)/;return patt_number.test(value)?!0:!1},domain:function(host){var host=host||"",regDomain=/^[а-яА-Яa-zA-Z0-9]+([\-]{0,2}[а-яА-Яa-zA-Z0-9])*$/;if(host=host.replace(/(^\s+|\s+$)/g,""),host.length>255)return!1;var domains=host.split(".");for(var i in domains)if(domains[i].length<1||domains[i].length>63||!regDomain.test(domains[i]))return!1;return!0},host:function(_host){return _host?validators.domain(_host)||validators.ipv4(_host):!0},hostv6:function(host){return host?validators.domain(host)||validators.ipv6(host):!0},mac:function(value){var patt_mac=/^([0-9a-fA-F][0-9a-fA-F][-:]){5}([0-9a-fA-F][0-9a-fA-F])$/;return patt_mac.test(value)},digits:function(val){return val?/^[0-9]*$/.test(val):!0},port:function(val){var patt=/^[0-9]*$/;return val&&(val=val.match(/\S+/)[0]),patt.test(val)?!0:!1},pppPassword:function(str){var patt;return str&&(patt=/[А-яёЁ]/,patt.test(str))?!1:!0},notCyrillicChar:function(str){var patt=/[АаБбВвГгДдЕеЁёЖжЗзИиЙйКкЛлМмНнОоПпРрСсТтУуФфХхЦцЧчШшЩщЪъЫыЬьЭэЮюЯя]+/g;return str?!patt.test(str):!0},psk:function(str){return!str||str.length>=8&&str.length<=63?!0:!1},ploam:function(str){var patt;return str&&(patt=/^\d{10}$/,!patt.test(str))?!1:!0},mail:function(str){var patt=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return str?patt.test(str):!0},network_address_v4:function(value){var ip,mask,net;return funcs.is.ipv4(value)||funcs.is.ipv4Network(value)?funcs.is.ipv4Network(value)&&(ip=value.split("/")[0],mask=value.split("/")[1],net=funcs.ipv4.address.and(ip,funcs.ipv4.mask["long"](mask)),ip!=net)?!1:!0:!1},network_address_v6:function(value){var ip,prefix,net;return funcs.is.ipv6(value)||funcs.is.ipv6Network(value)?funcs.is.ipv6Network(value)&&(ip=value.split("/")[0],prefix=value.split("/")[1]?value.split("/")[1]:"128",net=funcs.ipv6.subnet.getNetworkAddress(ip,prefix),funcs.ipv6.address.full(ip.toUpperCase())!=funcs.ipv6.address.full(net.toUpperCase()))?!1:!0:!1}};$model.$parsers.unshift(change),$model.$formatters.unshift(change),"mac"==$attrs.nwType&&$element.on("change",function(){var newValue,value=change($element.val()),isValidValue=validators.mac($element.val());value&&void 0!=value&&isValidValue&&(newValue=value.replace(/-/g,":").toUpperCase(),$model.$setViewValue(newValue),$model.$render()),$scope.$apply()})}}})}();