"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};angular.module(regdep("translate"),[]).run(["translate",function(translate){translate.fetchHierarchy(),window.baselang||translate.fetchBaseLanguage()}]).factory("translate",["$rootScope","$http","$sce","$q",function($rootScope,$http,$sce,$q){function translate(key,param){function getTempInstance(key,lang){function parseParams(paramsStr,lang,abr){var result={},pairs=paramsStr.split("&"),countParams=pairs.length;return _.each(pairs,function(pair){var value,baseValue,param=pair.split("="),nameParam=param[0],keyParam=param[1];nameParam&&keyParam&&("abr"!==nameParam?(value=lang[keyParam],value?result[nameParam]=value:nameParam in abr&&(baseValue=windowBaseLang[keyParam],baseValue&&(result[nameParam]=baseValue))):countParams--)}),_.keys(result).length===countParams?result:null}var result,origin,abr,params,instance=key.split("?"),originPart=instance[0],paramsPart=instance[1];return originPart&&paramsPart&&(origin=lang[originPart],origin&&(abr=getAbr(paramsPart),params=parseParams(paramsPart,lang,abr),params&&(result=applyTemplate(origin,params,abr)))),result?result:null}function isTempInstance(key){return/^\w+\?\w+=\w+/.test(key)}function applyTemplate(origin,params,abr){function setParam(nameParamStr){var result,first,nameParam=nameParamStr.slice(1),isUpperCaseFirst=function(symbol){var patt=/[A-Z]/;return patt.test(symbol)}(nameParam[0]);isUpperCaseFirst&&(nameParam=nameParam.toLowerCase());var transl=params[nameParam];return transl&&(transl=transl.toString(),abr&&abr[nameParam]?result=transl:(first=isUpperCaseFirst?transl[0].toUpperCase():transl[0].toLowerCase(),result=first+transl.slice(1))),result?result:nameParamStr}return 1==params.trustAsHtml?$sce.trustAsHtml(origin.replace(/:\w+/g,setParam)):origin.replace(/:\w+/g,setParam)}function getAbr(params){var pairs,index,abrStr,namesParam,abr,result={};return"string"==typeof params?(pairs=params.split("&"),index=_.findIndex(pairs,function(pair){return/^abr=\w+(,\w+)*/.test(pair)}),-1!==index&&(abrStr=pairs[index],namesParam=abrStr.split("=")[1].split(","),_.each(namesParam,function(name){result[name]=!0}))):(abr=params.abr,abr&&("object"===("undefined"==typeof abr?"undefined":_typeof(abr))?_.each(abr,function(name){result[name]=!0}):result[abr]=!0)),result}var result,lang,isString,isTempInst,tempInstance,baselang,baseTempInstance,abr,params,windowBaseLang=window.virtualBaselang?window.virtualBaselang:window.baselang;return key&&window.lang&&windowBaseLang&&(lang=window.lang[key],isString=_.isString(lang),isTempInst=isTempInstance(key),lang&&(isString||lang===!0&&isTempInst)?isString?result=lang:(tempInstance=getTempInstance(key,window.lang),tempInstance?result=tempInstance:(baseTempInstance=getTempInstance(key,windowBaseLang),result=baseTempInstance?baseTempInstance:key)):(baselang=windowBaseLang[key],baselang?_.isString(baselang)?result=baselang:baselang===!0&&isTempInst?(baseTempInstance=getTempInstance(key,windowBaseLang),result=baseTempInstance?baseTempInstance:key):result=key:result=key),param&&(abr=getAbr(param),params=_.omit(param,"abr"),result=applyTemplate(result,params,abr))),result}var activeLang="eng";return $rootScope.lang=activeLang,translate.checkKey=function(key){return key&&key.length?window.lang&&window.lang[key]&&""!=window.lang[key]?!0:windowBaseLang&&windowBaseLang[key]&&""!=windowBaseLang[key]?!0:!1:void 0},translate.changeLanguage=function(lang){translate.buildVirtualBaseLang(lang),$http({method:"GET",url:"/general/lang/"+lang+".js"}).success(function(data){try{eval.apply(window,[data]),$rootScope.lang=lang,activeLang=lang,$rootScope.$broadcast("changelang",lang)}catch(e){}})},translate.buildVirtualBaseLang=function(language){var hierarchy=window.hierarchy;if(!hierarchy||!hierarchy[language])return void(window.virtualBaselang=null);var langs=hierarchy[language],langpacks={},prom=[];_.each(langs,function(lang){function buildLangpacks(){return $http({method:"GET",url:"/general/lang/"+lang+".js"}).success(function(data){var obj,translation,langpack,currentLang;try{obj=null,translation=data.replace(/window.lang/,"obj"),langpack=eval(translation),currentLang="lang"+lang,langpacks[currentLang]=langpack}catch(e){window.virtualBaselang=null}})}prom.push(buildLangpacks())}),$q.all(prom).then(function(){window.virtualBaselang={},_.each(langs,function(lang){window.virtualBaselang=_.extend(window.virtualBaselang,langpacks["lang"+lang])})})["catch"](function(){window.virtualBaselang=null})},translate.fetchBaseLanguage=function(){var lang=autoconf&&!_.some(autoconf.__lang_arr,function(el){return"eng"==el})&&_.first(autoconf.__lang_arr)||"eng";return translate.fetchLanguage(lang)},translate.fetchLanguage=function(lang){return $http({method:"GET",url:"/general/lang/"+lang+".js"}).success(function(data){try{eval.apply(window,[data])}catch(e){}})},translate.fetchHierarchy=function(){$http({method:"GET",url:"/general/lang/hierarchy.js"}).success(function(data){try{eval.apply(window,[data])}catch(e){window.hierarchy={}}})["catch"](function(){window.hierarchy={}})},translate.getLang=function(){return activeLang},translate.getLangNames=function(){return $http.get("/general/lang/names.json").success(function(data){return translate.langNames=data})},translate}]).filter("translate",["translate",function(translate){return function(input,hideIfEmpty){var result;if(_.isObject(input))var result=translate(input.lang,_.omit(input,"lang"));else result=translate(input);return hideIfEmpty&&input==result?"":result}}]).directive("translate",["$rootScope","translate",function($rootScope,translate){return{restrict:"AEC",scope:{translate:"@",translateParams:"="},link:function(scope,elm){function change(){elm.html(translate(scope.$langkey,scope.translateParams))}scope.$langkey||(scope.$langkey=elm.html(),scope.$langkey||(scope.$langkey=scope.translate)),$rootScope.$on("changelang",function(){change()}),change()}}}]).service("detectLang",function(){function detect(){var langAttachmentsChinese={zh:"chs","zh-cn":"chs","zh-mo":"cht","zh-hk":"cht","zh-tw":"cht","zh-sg":"chs"},langAttachments={tr:"tur",tt:"tat",uk:"ukr",fa:"fas",fr:"fra",ru:"rus",en:"eng",hy:"arm",de:"ger",he:"heb",it:"ita",kk:"kaz",ko:"kor",lt:"lit",pt:"por",es:"spa",eu:"eus"},browserLang=navigator.language?navigator.language:navigator.userLanguage;return browserLang=browserLang.toLowerCase(),browserLang in langAttachmentsChinese?langAttachmentsChinese[browserLang]:(browserLang=browserLang.substr(0,2),browserLang in langAttachments?langAttachments[browserLang]:"eng")}return detect});