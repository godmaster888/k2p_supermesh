"use strict";!function(){function getNwFiled($element){for(var $nwField=$element.parent();$nwField&&!$nwField.hasClass("nwfield_element");)$nwField=$nwField.parent();return $nwField}var nw=angular.module(regdep("nw-mac"),[]);nw.directive("nwMacClone",["$compile",function($compile){return{restrict:"A",priority:1e3,link:function($scope,$element,$attrs){var $nwField=getNwFiled($element),template="<div nw-mac-clone-core nw-mac-clone-core-value="+$attrs.ngModel+"></div>",$cloneMac=angular.element($compile(template)($scope));$nwField&&$nwField.after($cloneMac),$scope.$on("nwmac.clone",function($event,value){value?$element.attr("nw-input-disabled","disabled"):$element.removeAttr("nw-input-disabled")})}}}]),nw.directive("nwMacCloneCore",["translate","nwMacPull",function(translate,pull){return{restrict:"A",template:'<div class="nw-mac-clone__container" ng-if="clone.isShow()"><div nw-labeled-switch nw-label="clone.getLabel()" nw-model="clone.state" nw-change="clone.changeState(clone.state)" nw-disabled="clone.isDisabled()" ></div></div>',scope:{value:"=nwMacCloneCoreValue"},link:function($scope){function changeState(value){$scope.$emit("nwmac.clone",value),value?cloneMac():cancelCloneMac()}function cloneMac(){$scope.clone.backupMac=_.clone($scope.value),$scope.value=clone.client}function cancelCloneMac(){_.isNull($scope.clone.backupMac)||($scope.value=_.clone($scope.clone.backupMac),$scope.clone.backupMac=null)}function isClientMac(){return!_.isNull(clone.client)&&!_.isUndefined($scope.value)&&clone.client.toUpperCase()==$scope.value.toUpperCase()}function isCanClone(){return!_.isNull(clone.client)}$scope.clone={isActivate:!1,state:!1,client:null,backupMac:null,getLabel:function(){var msg="";return isClientMac()?msg+=translate("wan_client_mac_address_used"):(msg+=translate("wan_clone_mac_address_message"),clone.client&&(msg+=" ("+clone.client.toUpperCase()+")")),msg},changeState:changeState,isShow:function(){return clone.isActivate&&isCanClone()}};var clone=$scope.clone;$scope.$watch("value",function(newValue,oldValue){newValue&&oldValue&&newValue.toUpperCase()!=oldValue.toUpperCase()&&(clone.state=isClientMac(),$scope.$emit("nwmac.clone",clone.state))}),pull().then(function(data){(function(data){return data&&data.mac&&data.mac.client})(data)&&(clone.client=data.mac.client.toUpperCase(),clone.isActivate=!0,clone.state=isClientMac(),changeState(clone.state))})}}}]),nw.directive("nwMacRestore",["$compile",function($compile){return{restrict:"A",priority:999,link:function($scope,$element,$attrs){var $nwField=getNwFiled($element),template="<div nw-mac-restore-core nw-mac-restore-core-value="+$attrs.ngModel+" nw-mac-restore-core-default-value = "+$attrs.nwMacRestore+".toUpperCase() nw-mac-restore-core-left-position = "+$attrs.nwMacRestoreLeftPosition+"></div>",$resoreMac=angular.element($compile(template)($scope));$nwField&&$nwField.after($resoreMac)}}}]),nw.directive("nwMacRestoreCore",["translate","nwMacPull",function(translate,pull){return{restrict:"A",template:'<div class="button_block no_top_margin bottom_margin" ng-class="{\'center\': !restore.isLeft(), \'left\': restore.isLeft(), \'full\': restore.isLeft()}" ng-if="restore.isShow()"><button type="button" class="colored" ng-click="restore.setMac()" ng-bind="\'wan_restore_mac_address_message\' | translate" ng-disabled="restore.isDisabled()" ></button></div>',scope:{value:"=nwMacRestoreCoreValue",defaultValue:"=nwMacRestoreCoreDefaultValue",leftPosition:"=nwMacRestoreCoreLeftPosition"},link:function($scope){function isCanRestore(){return $scope.defaultValue&&(restore.device=$scope.defaultValue),!_.isNull(restore.device)}function isDeviceMac(){return!_.isNull(restore.device)&&!_.isUndefined($scope.value)&&restore.device.toUpperCase()==$scope.value.toUpperCase()}$scope.restore={isActivate:!1,state:!1,device:null,setMac:function(){$scope.value=restore.device.toUpperCase()},isShow:function(){return restore.isActivate&&isCanRestore()},isDisabled:function(){return isDeviceMac()},isLeft:function(){return $scope.leftPosition}};var restore=$scope.restore;pull().then(function(data){(function(data){return data&&data.mac&&data.mac.device})(data)&&(restore.device=data.mac.device,restore.isActivate=!0)})}}}]),nw.factory("nwMacPull",["$q","devinfo","$timeout",function($q,devinfo){function pull(){function init(data){isLoading=!1,cache.mac={client:function(data){return!_.isUndefined(data.client)&&!_.isUndefined(data.client.mac)}(data)?data.client.mac:null,device:function(data){return!_.isUndefined(data.deviceMac)}(data)?data.deviceMac:null},deferred.resolve(cache)}var deferred=$q.defer();return isLoading?promise:(_.isEmpty(cache)?(isLoading=!0,promise=deferred.promise,devinfo.once("version|client").then(init)):deferred.resolve(cache),deferred.promise)}var promise,isLoading=!1,cache={};return pull}])}();