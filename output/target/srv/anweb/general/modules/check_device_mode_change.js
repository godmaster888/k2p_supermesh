"use strict";!function(){angular.module(regdep("modewatch"),["devinfo","app-module-funcs","ngDialog"]).service("checkDeviceModeChange",["$rootScope","$controller","devinfo","ngDialog","funcs","cookie",function($rs,$controller,devinfo,ngDialog,funcs,cookie){function handler(res){res&&res.deviceMode&&(currentMode=res.deviceMode,initedMode=initedMode||currentMode,cookie.get("device_mode"),initedMode===currentMode||isModeChanged||($rs.deviceMode=currentMode,isModeChanged=!0,showDialog()),initedMode===currentMode&&isModeChanged&&(isModeChanged=!1,closeDialog()))}function showDialog(){var config;ngDialog.isOpen(dialogID)||(config={template:"dialogs/check_device_mode_change/dialog.tpl.html",className:"check_device_mode_change_dialog",closeByDocument:!1,closeByEscape:!1,controller:"CheckDeviceModeChangeDialogCtrl",showClose:!1},lazyLoad&&(config.resolve=funcs.getLazyResolve("dialogs/check_device_mode_change/ctrl.lazy.js","CheckDeviceModeChangeDialogCtrl")),dialogID=ngDialog.open(config).id)}function closeDialog(){ngDialog.isOpen(dialogID)&&ngDialog.close(dialogID)}var currentMode,areas="notice",initedMode=null,isModeChanged=!1,dialogID=null,isRun=!1,lazyLoad=function(){try{return $controller("CheckDeviceModeChangeDialogCtrl",{$scope:{}},!0),!1}catch(ex){return!0}}();this.start=function(){isRun||(isRun=!0,devinfo.skipAuth.subscribe(areas,handler),console.info("Checking the device mode change is started"))},this.stop=function(){return devinfo.skipAuth.unsubscribe(areas,handler)}}]).run(["checkDeviceModeChange",function(checkDeviceModeChange){checkDeviceModeChange.start()}])}();