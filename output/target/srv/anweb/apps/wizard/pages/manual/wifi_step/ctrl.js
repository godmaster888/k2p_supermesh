"use strict";function WiFi24StepController($scope,$rootScope,manualProfile,apiDispatcher,funcs,translate){WiFiStepController($scope,$rootScope,manualProfile,apiDispatcher,funcs,translate,"2.4")}function WiFiStep5Controller($scope,$rootScope,manualProfile,apiDispatcher,funcs,translate){WiFiStepController($scope,$rootScope,manualProfile,apiDispatcher,funcs,translate,"5")}function WiFiStepController($scope,$rootScope,manualProfile,apiDispatcher,funcs,translate,freq){function onBandwidthRestrictedEnableChange(){profile.$WiFiStep[freq].GuestBandwidthRestricted.enable?profile.$WiFiStep[freq].GuestBandwidthRestricted.value=bandwithBackup:(bandwithBackup=angular.copy(profile.$WiFiStep[freq].GuestBandwidthRestricted.value),profile.$WiFiStep[freq].GuestBandwidthRestricted.value=0)}function onActivate(){"ap"==profile.$DeviceMode.Mode&&(profile.$WiFiStep[freq].GuestAP=!1)}function onWifiNetworkNameChange(){var postfix,withoutGuest;isGuestSSIDChanged||(postfix="_Guest",withoutGuest=32-postfix.length,profile.$WiFiStep[freq].GuestSSID=profile.$WiFiStep[freq].SSID.length<=withoutGuest?profile.$WiFiStep[freq].SSID+postfix:profile.$WiFiStep[freq].SSID.slice(0,withoutGuest)+postfix)}function isGBStandard(standard){return~["g","b","bg"].indexOf({1:"b",4:"g",15:"n",0:"bg",7:"gn",9:"bgn",14:"bgnac",5:"a",12:"an",18:"ac",21:"acn",24:"acan"}[standard])}function getEncrypTypes(){if(profile.$WiFiStep[freq]){var security=profile.$WiFiStep[freq].Security;if(!security)return[];var mode=security.ModeEnabled,openWEP=security.OpenWEP,standard=profile.$WiFiStep[freq].wirelessMode;if(!_.contains(["WEP"],mode)&&standard&&!isGBStandard(standard))return["AES"];if(profile.$WiFiStep[freq].WithoutPass&&openWEP)return["WEP"];switch(mode){case"None":return["NONE"];case"WEP":return["WEP"];case"WPA-Enterprise":return["TKIP"];case"WPA2-Enterprise":return["AES"];case"WPA-Personal":case"WPA2-Personal":case"WPA-WPA2-Personal":case"WPA-WPA2-Enterprise":return["TKIP","AES","TKIP+AES"]}return[]}}var profile=manualProfile.profile(),isGuestSSIDChanged=!1,wifiHelper=funcs.wifiHelper,bandwithBackup=0;$scope.wifiStep={profile:profile,onWifiEnableChange:function(){profile.$WiFiStep[freq]&&profile.$WiFiStep[freq].Enable===!1&&(profile.$WiFiStep[freq].GuestAP=!1)},onActivate:onActivate,checkWIFISSID:function(value){return value==profile.$WiFiStep[freq].defaultSSID?"dcc_default_ssid":null},checkPSK:function(value){if(value){if(!(value.length>=8&&value.length<=63))return"msg_invalid_password_length";if(/[а-яА-Я]+/.test(value))return"dcc_wifi_cyrillic";if(!/^[\x20-\x7E]+$/g.test(value))return"msg_password_contains_illegal"}return null},supportedParam:function(paramName,obj){return obj?_.has(obj,paramName):_.has(profile.$WiFiStep[freq],paramName)},onWifiNetworkNameChange:onWifiNetworkNameChange,onWifiGestSSIDChange:function(){isGuestSSIDChanged=!0},getChannelBandwidthList:function(){return profile.$WiFiStep[freq]?profile.$WiFiStep[freq].SupportedChannelBandwidth.split(","):[]},showCoexistence:function(bandwidth){return void 0!=profile.$WiFiStep[freq].Coexistence&&("20/40MHz"==bandwidth||"20/40/80MHz"==bandwidth)},getSecurityModes:function(){var authList=[{name:"WPA-PSK",value:"WPA-Personal"},{name:"WPA2-PSK",value:"WPA2-Personal"},{name:"WPA-PSK/WPA2-PSK mixed",value:"WPA-WPA2-Personal"},{name:"WPA",value:"WPA-Enterprise"},{name:"WPA2",value:"WPA2-Enterprise"},{name:"WPA/WPA2 mixed",value:"WPA-WPA2-Enterprise"}],standard=profile.$WiFiStep[freq].wirelessMode;return isGBStandard(standard)&&authList.splice(0,0,{name:"WEP",value:"WEP"}),authList},showSecurity:function(type){var mode=profile.$WiFiStep[freq].Security.ModeEnabled,withoutPass=profile.$WiFiStep[freq].WithoutPass,enableWEP=profile.$WiFiStep[freq].Security.OpenWEP;switch(type){case"enableWEP":return profile.$WiFiStep[freq].WithoutPass&&isGBStandard(profile.$WiFiStep[freq].wirelessMode);case"WEP":return"WEP"==mode||withoutPass&&enableWEP;case"PSK":return("WPA-Personal"==mode||"WPA2-Personal"==mode||"WPA-WPA2-Personal"==mode)&&!withoutPass;case"Enterprise":return("WPA-Enterprise"==mode||"WPA2-Enterprise"==mode||"WPA-WPA2-Enterprise"==mode)&&!withoutPass;default:return!1}},getDefaultKeysID:function(){return wifiHelper.getDefaultKeysID()},getWEPKeyLenMessage:function(){return profile.$WiFiStep[freq]?wifiHelper.getWEPKeyLenMessage(profile.$WiFiStep[freq]):null},validWEPKey:function(wepKey){return profile.$WiFiStep[freq]?wifiHelper.validWEPKey(wepKey,profile.$WiFiStep[freq]):null},validPSKKey:function(pskKey){return wifiHelper.validPSKKey(pskKey)},getEncrypTypes:getEncrypTypes,isRepeater:function(){return"Repeater"===profile.$InterfaceStep.WiFiMode?!0:!1},isWISPRepeater:function(){return"WISPRepeater"===profile.$InterfaceStep.WiFiMode},useRootParams:function(){profile.$WiFiStep[freq].WithoutPass="None"===profile.$WifiClientStep.Security.ModeEnabled,profile.$WiFiStep[freq].PSK!=profile.$WifiClientStep.Security.PreSharedKey&&(profile.$WiFiStep[freq].PSK=profile.$WifiClientStep.Security.PreSharedKey),profile.$WiFiStep[freq].SSID!=profile.$WifiClientStep.SSID&&(profile.$WiFiStep[freq].SSID=profile.$WifiClientStep.SSID),$scope.wifiStep.profile.$WiFiStep[freq].supportGuestAccess&&$scope.wifiStep.profile.$WiFiStep[freq].GuestSSID!=profile.$WifiClientStep.SSID+"_Guest"&&($scope.wifiStep.profile.$WiFiStep[freq].GuestSSID=profile.$WifiClientStep.SSID+"_Guest")},isShowGuestNetwork:function(){return"ap"==profile.$DeviceMode.Mode?!1:profile.$WiFiStep[freq].supportGuestNet&&profile.$WiFiStep[freq].Enable},getGuestNetworkDesc:function(){var desc=translate("dcc_enable_guest_network_desc1");return $scope.wifiStep.profile.$WiFiStep[freq].supportGuestAccess&&(desc=desc+" "+translate("dcc_enable_guest_network_desc2")+" "+translate("dcc_enable_guest_network_desc3")),desc},isDisabled:function(param){function checkMesh(band){return profile.$WiFiStep[band]&&profile.$WiFiStep[band].SuperMeshEnable}function checkClient(band){return profile.$WifiClientStep&&profile.$WifiClientStep.Band==band}switch(param){case"SuperMeshEnable":return checkMesh("2.4"==freq?"5":"2.4")||checkClient(freq+"GHz")}},isMeshEnable:function(band){return profile.$InterfaceStep.MeshEnable&&profile.$InterfaceStep.MeshBand==band+"GHz"}},$scope.$watch(getEncrypTypes,function(types){if(types&&profile.$WiFiStep[freq].Security){var encr=profile.$WiFiStep[freq].Security.EncryptionType;_.contains(types,encr)||(profile.$WiFiStep[freq].Security.EncryptionType=types[0])}},!0),apiDispatcher.get().registerStepApi({name:"2.4"==freq?"WiFiStep":"WiFi5GStep",onActivate:onActivate}),"5"==freq&&($scope.wifiStep.onBandwidthRestrictedEnableChange=onBandwidthRestrictedEnableChange,$scope.wifiStep.band=freq),$scope.freq=freq,$scope.boradcastMessage=translate("wifi_broadcast")+" "+freq+" "+translate("units_GHz"),console.log("Freq: "+$scope.freq)}angular.module("wizard").controller("WiFiStep24Controller",WiFi24StepController).controller("WiFiStep5Controller",WiFiStep5Controller),WiFi24StepController.$inject=["$scope","$rootScope","manualProfile","manualStepApiDispatcher","funcs","translate"],WiFiStep5Controller.$inject=["$scope","$rootScope","manualProfile","manualStepApiDispatcher","funcs","translate"];