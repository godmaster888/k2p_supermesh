"use strict";!function(){angular.module("wizard").service("usbModemStepUtil",["cpe","dongle",function(cpe,dongle){return{dongleHandler:function(data,profile,$scope){var dongleData,modem;if(data&&data.dongle){if(profile.__modemFields||"wan_created"==dongle.state())return;if(dongle.info(data.dongle),dongleData={},profile.$DongleStep.Modem||(modem=_.first(data.dongle),modem&&(profile.$DongleStep.Modem=modem.__id,profile.$DongleStep.SIM=modem.activeSIM.toString())),dongleData=_.find(data.dongle,function(o){return o.__id==profile.$DongleStep.Modem}),console.log("dongleData",dongleData),!dongleData)return void dongle.state("wait_dongle");data.lteIntersectedSubnet?dongle.state("intersected_subnet"):dongleData.notUseSIM||2!=dongleData.pinStatus?_.contains(["PIN","PUK"],dongleData.pinStatus)?(dongle.state("wait_pin"),$scope.dongleStep.modemPinStatus=dongleData.pinStatus,$scope.dongleStep.modemTryLeft=dongleData.pinTryLeft>0?dongleData.pinTryLeft:null):"wait_create"==dongle.state()?dongleData.hasConnection?(dongle.state("wan_created"),$scope.dongleStep.stopSubscribe()):_.now()-$rootScope.rootDongleReadyStamp>$scope.dongleStep.modemAutoconnectTimeout&&(profile.__modemFields=!0,dongle.state("wan_failed"),$scope.dongleStep.stopSubscribe()):!(!_.has(dongleData,"actualMode")&&("ready"==dongleData.status||"init"==dongleData.status)||_.has(dongleData,"actualMode")&&"ready"==dongleData.status&&"LTE"==dongleData.actualMode||"init"==dongleData.status&&"3G"==dongleData.actualMode)||dongleData.pinStatus&&"Ready"!=dongleData.pinStatus?dongle.state("wait_dongle"):dongleData.autoconnect?($scope.dongleStep.modemType=dongleData.actualMode,dongle.state("wait_create")):(dongle.state("wan_failed"),profile.__modemFields=!0):dongle.state("wait_sim")}},changeSIM:function(modemId,simId){return cpe.SetParameterValues([{Name:"Device.USB.Modem."+modemId+".ActiveSIM",Value:Number(simId)}])},applyPIN:function(dataPIN,modemId,simId){var curDongle=_.find(dongle.info(),function(o){return o.__id==modemId}),params=[];return"PIN"==curDongle.pinStatus?params.push({Name:"PIN",Value:dataPIN.PIN}):(params.push({Name:"PUK",Value:dataPIN.PIN}),params.push({Name:"PIN",Value:dataPIN.newPin})),cpe.Execute("Device.USB.Modem."+modemId+".SIM."+simId+".PIN.Verify",params).then(function(response){var isSuccess=_.find(response.result.ParameterList,{Name:"Success"});return isSuccess.Value?Promise.resolve():Promise.reject()})},changeOrder:function(groupInst){return cpe.ChangeOrder("Device.Network.Group.1.WAN."+groupInst,0)}}}])}();