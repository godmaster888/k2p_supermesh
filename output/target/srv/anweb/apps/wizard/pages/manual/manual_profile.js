"use strict";!function(){angular.module("wizard").factory("manualProfile",["$rootScope","devinfo","dataShare","translate","funcs","manualDefaults",function($rootScope,devinfo,dataShare,translate,funcs,defaults){function init(){var profileDefaults={$ProfileID:null,$Tags:[],$Support:{},$InterfaceStep:{IfaceType:"",WiFiMode:""},$DongleStep:{Modem:null,SIM:null},$InternetStep:{WANType:"",Username:"",Password:"",Origin:"AutoConfigured",ServiceName:"",Mac:"",DialNumber:"",APN:"",CloneMac:!1,UseVLAN:!1,VID:null,VPI:"",VCI:"",ModemList:[],Modem:"",ModemAutoConnection:!0},$EtherWAN:{Port:null},$WifiClientStep:{ConnectMode:"select"},$WiFiWdsStep:{Mode:"Repeater",EncryptionType:"None",EncryptionKey:"",Mac:{1:"",2:"",3:"",4:""}},$LANStep:{IPv4:{AddressingMode:"Static",DHCP:{Mode:"Disable",Server:{MinAddress:null,MaxAddress:null}},StaticIP:{1:{Address:null,SubnetMask:null,DNS:"8.8.8.8",AddnHostname:null}}},LocalDomain:{Enabled:autoconf.BR2_PACKAGE_ANWEB_MDNS_HOSTNAME_IN_AP_MODE,Example:"dlinkap12ab.local./"}},$WiFiStep:{2.4:{Enable:!0,EnableBroadcast:!0,SSID:"WiFi",PSK:"",WithoutPass:!1,GuestAP:!1,GuestSSID:"WiFi-Guest",GuestPSK:"",GuestWithoutPass:!0,ShowAdvSettings:!1},5:{Enable:!0,EnableBroadcast:!0,SSID:"WiFi5",PSK:"",WithoutPass:!1,GuestAP:!1,GuestSSID:"WiFi5-Guest",GuestPSK:"",GuestWithoutPass:!0,ShowAdvSettings:!1}},$SuperMesh:{AvailRoles:availRoles},$WiFiRoamingStep:{Enable:!1},$IPTVStep:{Use:!1,UseVID:!1,VID:null,VPI:null,VCI:null},$VoIPStep:{Use:!1,UseVID:!1,VID:null,VPI:null,VCI:null},$PasswordStep:{Login:$rootScope.gAuth.username,Password:""},$SystemLanguage:{Language:translate.getLang()},$Groups:{lan:[],wifi:[]},$RemoteUpdate:{Enable:!0},$DeviceMode:{Mode:null},$HotSpotStep:{Enable:!1}};return funcs.deepExtend(profileDefaults,defaults),_profile=dataShare.setIfEmpty("ManualBackup",funcs.deepClone(profileDefaults)),_profile=dataShare.setIfEmpty("ManualProfile",profileDefaults)}function reset(){_.extend(_profile,funcs.deepClone(dataShare.get("ManualBackup"))),dataShare.set("ManualProfile",_profile)}function getProfile(){return _profile}function getService(portName){var found=_.find(_profile.$Groups.all,function(port){return portName==port.name});return found?found.service:void 0}function setService(port,service){var found=_.find(_profile.$Groups.all,function(__port){return port.name==__port.name});if(found){if(_.some(_profile.$Groups.wan,function(p){return p.name==port.name})&&"etherwan"!=_profile.$InterfaceStep.IfaceType)return null;if(_profile.$EtherWAN.Port&&_profile.$EtherWAN.Port==port.name)return null;if(port.management)return"dcc_port_mgm_warn";found.service=found.service==service?"":service}}function clearServices(service){_.each(_profile.$Groups.lan,function(port){port.service==service&&(port.service="")})}function equalVlanId(stepOne,stepTwo){var stepUseVlan={$InternetStep:_profile.$InternetStep.UseVLAN,$VoIPStep:_profile.$VoIPStep.Use&&_profile.$VoIPStep.UseVID,$IPTVStep:_profile.$IPTVStep.Use&&_profile.$IPTVStep.UseVID};return stepUseVlan[stepOne]&&stepUseVlan[stepTwo]&&_profile[stepOne].VID&&_profile[stepTwo].VID&&_profile[stepOne].VID===_profile[stepTwo].VID}function equalVPIVCI(stepOne,stepTwo){return _profile[stepOne].VPI===_profile[stepTwo].VPI&&_profile[stepOne].VCI===_profile[stepTwo].VCI}function isWDSMode(mode){return"WDS"==_profile.$InterfaceStep.WiFiMode&&_profile.$WiFiWdsStep.Mode==mode}function setLANMode(dynamic){var IPv4Static=_profile.$LANStep.IPv4.StaticIP[1],IPv4DHCP=_profile.$LANStep.IPv4.DHCP;_profile.$LANStep.IPv4.AdressingType=dynamic?"Dynamic":"Static",dynamic?(_profile.$LANStep.IPv4.AddressingMode="Dynamic",IPv4Static.Address=IPv4Static._DefaultAddress,IPv4Static.SubnetMask=IPv4Static._DefaultSubnetMask,IPv4Static.GatewayAddress="",IPv4DHCP.Mode="Enable",IPv4DHCP.Server.MinAddress=null,IPv4DHCP.Server.MaxAddress=null):(_profile.$LANStep.IPv4.AddressingMode="Static",IPv4DHCP.Mode="Disable",IPv4DHCP.Server.MinAddress=null,IPv4DHCP.Server.MaxAddress=null)}var _profile=null,availRoles=[];return availRoles.push("master"),availRoles.push("slave"),{init:init,profile:getProfile,reset:reset,backup:function(profile){dataShare.set("ManualBackup",funcs.deepClone(profile))},clean:function(){dataShare.remove("ManualProfile"),_profile=null},setService:setService,getService:getService,clearServices:clearServices,equalVlanId:equalVlanId,checkJointVLAN:function(step){return equalVlanId(step,"$InternetStep")?"dcc_tag_used":equalVlanId("$IPTVStep","$VoIPStep")?"dcc_joint_vlan":void 0},isWDSMode:isWDSMode,equalVPIVCI:equalVPIVCI,checkJointVPIVCI:function(step){return equalVPIVCI(step,"$InternetStep")?"dcc_tag_used_dsl":equalVPIVCI("$IPTVStep","$VoIPStep")?"dcc_joint_vlan":void 0},setVIDEnable:function(is){_.each(["$IPTVStep","$VoIPStep"],function(step){_profile[step]&&(_profile[step].UseVID=is)})},requiredVID:function(){return!1},setLANMode:setLANMode}}])}();