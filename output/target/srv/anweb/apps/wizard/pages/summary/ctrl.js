"use strict";function _toConsumableArray(arr){var i,arr2;if(Array.isArray(arr)){for(i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}angular.module("wizard").controller("wizardSummaryCtrl",["$scope","$rootScope","$state","$stateParams","profiles","devinfo","translate","regions","dataShare","stepManager","profileInspector","$timeout","$injector",function($scope,$rootScope,$state,$stateParams,profiles,devinfo,translate,regions,dataShare,stepManager,profile,$timeout){function seviceToHuman(service){if(!service)return"";switch(service.toLowerCase()){case"":return"";case"iptv":return"IPTV";case"voip":return"VoIP";default:return"IPTV+VoIP"}}function addFileLine(s,v,simple){v||(v=""),simple?($scope.summaryFile&&($scope.summaryFile+="\r\n"),$scope.summaryFile+=translate(s)):""==s?$scope.summaryFile+=translate(s)+": "+v:($scope.summaryFile&&($scope.summaryFile+="\r\n"),$scope.summaryFile+=translate(s)+": "+v)}function addFileFields(fields){_.each(fields,function(field){field.hide||addFileLine(field.name,field.value)})}function addFileBR(){$scope.summaryFile+="\r\n"}function getDestinationAddress(conn){var destAddr;return conn&&"DSL.ATM"==conn.MediaType?(destAddr=conn.Media.DSL.ATM.DestinationAddress,[{name:"VPI",value:destAddr.split("/")[0]},{name:"VCI",value:destAddr.split("/")[1]}]):[]}function onData(info){info&&(devinfo.unsubscribe("version|net",onData),$scope.summary=$scope.compileSummary($scope.nativeData,info))}function getConnectionPassword(conn){return conn.WithoutAuth?null:"PROTECTED-ad2f4833"!=conn.Password?conn.Password:"*****"}function getPPPoEName(conn){if(conn.UnnumberedIP)return"wan_pppoe_unnum";var isPPPoA="DSL.ATM"==conn.MediaType&&"PPPoA"==conn.Media.DSL.ATM.LinkType;return isPPPoA?"PPPoA":"PPPoE"}$scope.stepData=stepManager.getData(),$scope.device,$scope.applying=!1,profile.set($scope.nativeData);var originToHuman={Auto:"wan_ipv6_auto_configured",AutoConfigured:"wan_ipv6_auto_configured",AutoConfiguredByDHCPv6:"wan_ipv6_auto_configured_by_dhcp_v6",AutoConfiguredBySlaac:"wan_ipv6_auto_configured_by_slaac"},manualProfile=dataShare.get("ManualProfile"),isApMode="ap"===manualProfile.$DeviceMode.Mode,isClient="Client"===manualProfile.$InterfaceStep.WiFiMode,isRepeater="Repeater"===manualProfile.$InterfaceStep.WiFiMode,isWDS="WDS"===manualProfile.$InterfaceStep.WiFiMode,isWISPRepeater="WISPRepeater"===manualProfile.$InterfaceStep.WiFiMode,isWDSInBridge=isWDS&&"Bridge"==manualProfile.$WiFiWdsStep.Mode,deviceSection={name:"dcc_smr_device",fields:[]},modes={Router:"dcc_mod_router",WISPRepeater:"dcc_mod_wisp_repeater",AP:"dcc_mod_access_point",Repeater:"dcc_mod_repeater",Client:"dcc_mod_client",WDS:"WDS",USB:"dcc_mod_router"};$scope.summaryFile="",$scope.lanPorts=_.clone($rootScope.gLanPorts),$scope.gReversPortNames||$scope.lanPorts.reverse(),$scope.region=dataShare.get("FoundRegion"),$scope.compileSummary=function(native,info){$scope.summaryFile="";var group,connInfo,dongleName,service,conn,dynIp,password,name,modemName,isATM,isIPoA,fields,origin,IPv4,StaticIP,WDS,isOpen,sorted,timeZone,timeZoneUTC,wanVID=null;regions.byID(native.RegionID);var result=[],wanConnection=_.chain(native.Config.WAN).values().pluck("Connection").compact().pluck("1").compact().first().value();if(!wanConnection&&info.ipv4gw&&/mobileinet/.test(info.ipv4gw.contype)){var group={name:"connection",fields:[]};group.fields.push({name:"dcc_interface_type_step",value:translate(info.ipv4gw.contype)}),result.push(group),info.ipv4gw.__usb_data&&(connInfo={name:"wan_modem",fields:[{name:"username",value:info.ipv4gw.__usb_data.username},{name:"password",value:info.ipv4gw.__usb_data.password,hide:!info.ipv4gw.__usb_data.password},{name:"APN",value:info.ipv4gw.__usb_data.apn},{name:"wan_dial_number",value:info.ipv4gw.__usb_data.dial_number}]},result.push(connInfo),addFileLine("username",info.ipv4gw.__usb_data.username),password&&addFileLine("password",info.ipv4gw.__usb_data.password),addFileLine("APN",info.ipv4gw.__usb_data.apn),addFileLine("wan_dial_number",info.ipv4gw.__usb_data.dial_number))}if(wanConnection&&"Ethernet"!=wanConnection.MediaType){switch(group={name:"connection",fields:[]},wanConnection.MediaType){case"Dongle":dongleName="mobileinet",group.fields.push({name:"dcc_interface_type_step",value:translate(dongleName)});break;case"WiFi":group.name=""}result.push(group)}if(wanConnection&&"DSL.PTM"==wanConnection.MediaType)wanConnection.VLAN.Enable&&(wanVID=wanConnection.VLAN.ID);else if(native.Config.VLAN){var service=_.find(_.pairs(native.Config.VLAN.services),function(pair){return"internet"==_.first(pair)});service&&_.last(service).vid&&(wanVID=_.last(service).vid)}if($scope.gFirstData&&$scope.gFirstData.Password?(addFileLine("username","admin"),addFileLine("password",$scope.gFirstData.Password)):native.Config.SystemPassword&&(addFileLine("username",native.Config.SystemPassword.Login),addFileLine("password",native.Config.SystemPassword.Password)),native.Config.LAN&&native.Config.LAN[1].IPv4?"Dynamic"==native.Config.LAN[1].IPv4.AddressingMode?addFileLine("dcc_smr_devip",translate("lan_addressing_mode_dynamic")+" ("+translate("dcc_smr_devip_desc")+" "+native.Config.LAN[1].IPv4.StaticIP[1].Address+")"):addFileLine("dcc_smr_devip",native.Config.LAN[1].IPv4.StaticIP[1].Address):addFileLine("dcc_smr_devip",info.lan[0].ip),addFileBR(),native.Config.WAN){if(profile.isViewFound(/Config.WAN.Bridge.Connection.1./)){var conn=native.Config.WAN.Bridge.Connection[1];result.push({name:"Bridge",fields:[{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine("Bridge"),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.PPTP.Connection.1./)){var dynIp=native.Config.WAN.IPv4oE.Connection[2];dynIp&&(result.push({name:"dynip",fields:[{name:"VLAN ID",value:wanVID,hide:!wanVID}]}),wanVID?(addFileLine(translate("dynip")),wanVID&&addFileLine("VLAN ID",wanVID)):addFileLine(translate("dynip"),null,!0));var conn=native.Config.WAN.PPTP.Connection[1],password=getConnectionPassword(conn);result.push({name:conn.ActualType,fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"wan_vpn_service_name",value:conn.ServiceName},{name:"VLAN ID",value:wanVID,hide:!wanVID||!0}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine(conn.ActualType),addFileLine("username",conn.Username),password&&addFileLine("password",password),addFileLine("wan_vpn_service_name",conn.ServiceName)}if(profile.isViewFound(/Config.WAN.PPPoE.Connection.1./)){dynIp=native.Config.WAN.IPv4oE&&native.Config.WAN.IPv4oE.Connection[2],dynIp&&(result.push({name:"dynip",fields:[{name:"VLAN ID",value:wanVID,hide:!wanVID}]}),wanVID?(addFileLine(translate("dynip")),wanVID&&addFileLine("VLAN ID",wanVID)):addFileLine(translate("dynip"),null,!0));var conn=native.Config.WAN.PPPoE.Connection[1];name=getPPPoEName(conn);var password=getConnectionPassword(conn);result.push({name:translate(name),fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"wan_service_name",value:conn.ServiceName,hide:!conn.ServiceName},{name:"VLAN ID",value:wanVID,hide:!wanVID},{name:"ip_address",value:conn.UnnumberedIP?conn.UnnumberedIP.Address:null,hide:_.isUndefined(conn.UnnumberedIP)},{name:"subnet_mask",value:conn.UnnumberedIP?conn.UnnumberedIP.SubnetMask:null,hide:_.isUndefined(conn.UnnumberedIP)}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine(translate(name)),addFileLine("username",conn.Username),password&&addFileLine("password",password),conn.ServiceName&&addFileLine("wan_service_name",conn.ServiceName),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.PPPoEDual.Connection.1./)){var conn=native.Config.WAN.PPPoEDual.Connection[1],password=getConnectionPassword(conn);result.push({name:"PPPoE Dual Stack",fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"wan_service_name",value:conn.ServiceName,hide:!conn.ServiceName},{name:"dcc_ipv6by",value:translate(originToHuman[conn.Origin])},{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine("PPPoE Dual Stack"),addFileLine("username",conn.Username),password&&addFileLine("password",password),conn.ServiceName&&addFileLine("wan_service_name",conn.ServiceName),addFileLine("dcc_ipv6by",translate(originToHuman[conn.Origin])),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.PPPoEv6.Connection.1./)){var conn=native.Config.WAN.PPPoEv6.Connection[1],password=getConnectionPassword(conn);result.push({name:"IPv6 PPPoE",fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"wan_service_name",value:conn.ServiceName,hide:!conn.ServiceName},{name:"dcc_ipv6by",value:translate(originToHuman[conn.Origin])},{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine("IPv6 PPPoE"),addFileLine("username",conn.Username),password&&addFileLine("password",password),conn.ServiceName&&addFileLine("wan_service_name",conn.ServiceName),addFileLine("dcc_ipv6by",translate(originToHuman[conn.Origin])),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.3G.Connection.1./)){var conn=native.Config.WAN["3G"].Connection[1],password=getConnectionPassword(conn),modemName="wan_modem";result.push({name:modemName,fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"APN",value:conn.APN},{name:"wan_dial_number",value:conn.DialNumber},{name:"VLAN ID",value:wanVID,hide:!wanVID}]}),addFileLine("3G"),addFileLine("username",conn.Username),password&&addFileLine("password",password),addFileLine("APN",conn.APN),addFileLine("wan_dial_number",conn.DialNumber),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.LTE.Connection.1./)){var conn=native.Config.WAN.LTE.Connection[1],password=getConnectionPassword(conn);modemName="wan_modem",result.push({name:modemName,fields:[{name:"username",value:conn.Username},{name:"password",value:password,hide:!password},{name:"APN",value:conn.APN},{name:"VLAN ID",value:wanVID,hide:!wanVID}]}),addFileLine("LTE"),addFileLine("username",conn.Username),password&&addFileLine("password",password),addFileLine("APN",conn.APN),wanVID&&addFileLine("VLAN ID",wanVID)}if(profile.isViewFound(/Config.WAN.IPv4oE.Connection.1./)&&!profile.isViewFound(/Config.WAN.IPv6oE.Connection.1./)){var conn=native.Config.WAN.IPv4oE.Connection[1],isATM="DSL.ATM"==conn.MediaType,isIPoA=isATM&&"IPoA"==conn.Media.DSL.ATM.LinkType;if("Static"==conn.AddressingType){var fields=[{name:"ip_address",value:conn.StaticIPAddress0},{name:"subnet_mask",value:conn.StaticIPSubnetMask0},{name:"wan_gateway_ip",value:conn.GatewayIPAddress}];fields.push({name:"dcc_dns",value:conn.DNSServer1}),wanVID&&(fields=fields.concat([{name:"VLAN ID",value:wanVID,hide:!wanVID}])),fields=fields.concat(getDestinationAddress(conn)),result.push({name:isIPoA?"IPoA":"statip",fields:fields}),addFileLine(isIPoA?"IPoA":translate("statip")),addFileLine("ip_address",conn.StaticIPAddress0),addFileLine("subnet_mask",conn.StaticIPSubnetMask0),addFileLine("wan_gateway_ip",conn.GatewayIPAddress),addFileLine("dcc_dns",conn.DNSServer1),wanVID&&addFileLine("VLAN ID",wanVID),addFileBR()}else result.push({name:"dynip",fields:[{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),wanVID?(addFileLine(translate("dynip")),wanVID&&addFileLine("VLAN ID",wanVID)):addFileLine(translate("dynip"),null,!0)}if(profile.isViewFound(/Config.WAN.IPv6oE.Connection.1./)&&!profile.isViewFound(/Config.WAN.IPv4oE.Connection.1./)){var conn=native.Config.WAN.IPv6oE.Connection[1];if("Static"==conn.Origin)result.push({name:"statipv6",fields:[{name:"ip_address",value:conn.StaticIPAddress0},{name:"prefix",value:conn.Prefix},{name:"wan_gateway_ip",value:conn.GatewayIPAddress},{name:"dcc_dns",value:conn.DNSServer1,hide:!conn.DNSServer1},{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine(translate("statipv6")),addFileLine("ip_address",conn.StaticIPAddress0),addFileLine("prefix",conn.Prefix),addFileLine("wan_gateway_ip",conn.GatewayIPAddress),conn.DNSServer1&&addFileLine("dcc_dns",conn.DNSServer1),wanVID&&addFileLine("VLAN ID",wanVID),addFileBR();else{var conn=native.Config.WAN.IPv6oE.Connection[1];origin=translate(originToHuman[conn.Origin]),result.push({name:"dynipv6",fields:[{name:"dcc_ipv6by",value:origin},{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),addFileLine(translate("dynipv6")),addFileLine("dcc_ipv6by",origin),wanVID&&addFileLine("VLAN ID",wanVID)}}profile.isViewFound(/Config.WAN.IPv4oE.Connection.1./)&&profile.isViewFound(/Config.WAN.IPv6oE.Connection.1./)&&(conn=native.Config.WAN.IPv4oE.Connection[1],isATM="DSL.ATM"==conn.MediaType,isIPoA=isATM&&"IPoA"==conn.Media.DSL.ATM.LinkType,result.push({name:"wan_ipoe_dual",fields:[{name:"VLAN ID",value:wanVID,hide:!wanVID}].concat(_toConsumableArray(getDestinationAddress(conn)))}),wanVID?(addFileLine(translate("wan_ipoe_dual")),wanVID&&addFileLine("VLAN ID",wanVID)):addFileLine(translate("wan_ipoe_dual"),null,!0)),addFileFields(getDestinationAddress(conn)),addFileBR()}if(native.Config.LAN&&(IPv4=native.Config.LAN[1].IPv4,IPv4&&IPv4.StaticIP)){StaticIP=IPv4.StaticIP[1];var fields=[];"Dynamic"==IPv4.AddressingMode?fields.push({name:"dynip",value:translate("yes")}):(fields.push({name:"ip_address",value:StaticIP.Address}),fields.push({name:"subnet_mask",value:StaticIP.SubnetMask}),fields.push({name:"lan_gw_ip",value:StaticIP.GatewayAddress})),StaticIP.AddnHostname&&fields.push({name:"hostname",value:StaticIP.AddnHostname}),fields=_.filter(fields,function(e){return!!e.value}),result.push({name:"LAN",fields:fields}),addFileLine("LAN"),addFileFields(fields),addFileBR()}return isWDS&&(WDS=native.Config.WiFi.WDS,isOpen="None"==WDS.EncryptionType,fields=[{name:"wifi_wds_mode",value:translate("wifi_wds_mode"+WDS.Mode)},{name:"wifi_wds_encrypt",value:isOpen?"Open":WDS.EncryptionType},{name:"wifi_wds_key",value:WDS.EncryptionKey,hide:isOpen}],_.each(WDS.Mac,function(mac,key){fields.push({name:"wifi_wds_mac",value:mac,hide:!mac,position:key})}),result.push({name:"WDS",fields:fields}),addFileLine("WDS"),addFileFields(fields),addFileBR()),native.Config.EtherWAN&&(_.isEmpty(native.Config.EtherWAN.Port)?addFileLine("dcc_inet_port","Internet"):addFileLine("dcc_inet_port",translate("port")+native.Config.EtherWAN.Port.replace(/[a-zA-Z]+/,"")),addFileBR()),!native.Config.WiFi||isClient||isWDSInBridge||_.each(native.Config.WiFi.Radio,function(radio){if("2.4GHz"==radio.OperatingFrequencyBand)var band=translate("24ghz"),testData=$rootScope.gWifiChangeTest24;else band=translate("5ghz"),testData=$rootScope.gWifiChangeTest5;var band,testData,security,guestWiFi,ap=radio.AccessPoint[1],wifi={name:"Wi-Fi "+band,fields:[{name:"dcc_smr_enable",value:translate(radio.Enable?"yes":"no")}]};if(radio.Enable&&$rootScope.rootIsWIFIClient&&!_.isUndefined(testData)&&!_.isEqual(testData,radio)&&(wifi.warn=translate("dcc_smr_wifi_warn")),radio.Enable){if(ap){var security=ap.Security;wifi.fields.push({name:"SSID",value:ap.SSID}),addFileLine("Wi-Fi "+band),addFileLine("dcc_smr_ssid",ap.SSID),"None"==security.ModeEnabled?wifi.fields.push({name:"dcc_smr_encrypt",value:translate("wifi_not_encr")}):(wifi.fields.push({name:"dcc_smr_encrypt",value:security.ModeEnabled}),security.ModeEnabled.indexOf("Personal")&&(wifi.fields.push({name:"password",value:"PROTECTED-ad2f4833"!=security.PreSharedKey?security.PreSharedKey:"*****"}),addFileLine("password","PROTECTED-ad2f4833"!=security.PreSharedKey?security.PreSharedKey:"*****")))}_.isBoolean(radio.SuperMeshEnable)&&wifi.fields.push({name:"dcc_mesh_enable",value:translate(radio.SuperMeshEnable?"yes":"no")})}result.push(wifi);var guestAp=radio.AccessPoint[2];guestAp&&(guestWiFi={name:"Wi-Fi "+band+" ("+translate("guest")+")",fields:[{name:"dcc_smr_enable",value:translate(radio.Enable?"yes":"no")}]},security=guestAp.Security,guestWiFi.fields.push({name:"SSID",value:guestAp.SSID}),addFileLine("dcc_smr_guest_ssid",guestAp.SSID),"None"==security.ModeEnabled?guestWiFi.fields.push({name:"dcc_smr_encrypt",value:translate("wifi_not_encr")}):(guestWiFi.fields.push({name:"dcc_smr_encrypt",value:security.ModeEnabled}),security.ModeEnabled.indexOf("Personal")&&(guestWiFi.fields.push({name:"password",value:"PROTECTED-ad2f4833"!=security.PreSharedKey?security.PreSharedKey:"*****"}),addFileLine("dcc_smr_guest_pass","PROTECTED-ad2f4833"!=security.PreSharedKey?security.PreSharedKey:"*****"))),guestAp.BandwidthRestricted&&(guestWiFi.fields.push({name:"wifi_client_shaping_nav",value:guestAp.BandwidthRestricted+" "+translate("units_mbps")}),addFileLine("wifi_client_shaping_nav",guestAp.BandwidthRestricted)),guestAp.MaxAssociatedDevices&&(guestWiFi.fields.push({name:"wifi_max_clients",value:guestAp.MaxAssociatedDevices}),addFileLine("wifi_max_clients",guestAp.MaxAssociatedDevices)),result.push(guestWiFi)),addFileBR()}),(native.Config.VLAN&&$scope.showPortPanel()||$scope.nativeData.Config.GroupingInterfaces)&&(service=native.Config.VLAN&&native.Config.VLAN.services,fields=[],addFileLine("dcc_smr_services"),sorted=_.sortBy($scope.services,function(s){return s.name}),_.each(sorted,function(port){var portInfo,alias,service;port.service&&(portInfo=_.findWhere($scope.rootAvailPorts,{name:port.name}),alias=portInfo&&portInfo.alias||port.name,service=seviceToHuman(port.service),fields.push({name:alias,value:service}),addFileLine(alias,service))}),_.has(service,"iptv")&&service.iptv.vid&&(fields.push({name:seviceToHuman("iptv")+" VLAN ID",value:service.iptv.vid}),addFileLine(seviceToHuman("iptv")+" VLAN ID",service.iptv.vid)),_.has(service,"voip")&&service.voip.vid&&(fields.push({name:seviceToHuman("voip")+" VLAN ID",value:service.voip.vid}),addFileLine(seviceToHuman("voip")+" VLAN ID",service.voip.vid)),_.has(service,"iptv_voip")&&service.iptv_voip.vid&&(fields.push({name:seviceToHuman("iptv_voip")+" VLAN ID",value:service.iptv_voip.vid}),addFileLine(seviceToHuman("iptv_voip")+" VLAN ID",service.iptv_voip.vid)),result.push({name:"dcc_smr_services",fields:fields}),addFileBR()),deviceSection.fields=[{name:"summary_model",value:info.modelName}],deviceSection.fields.push({name:"dcc_smr_software_version",value:info.version}),deviceSection.fields.push({name:"dcc_smr_serial",value:info.serialNumber,hide:!info.serialNumber}),isApMode||deviceSection.fields.push(profile.containLAN()?{name:"IP",value:native.Config.LAN[1].IPv4.StaticIP[1].Address}:{name:"IP",value:_.first(info.lan).ip}),manualProfile&&manualProfile.$InterfaceStep.WiFiMode&&(deviceSection.fields.push({name:"mode",value:translate(modes[manualProfile.$InterfaceStep.WiFiMode])}),addFileLine("mode",translate(modes[manualProfile.$InterfaceStep.WiFiMode]))),(isClient||isRepeater||isWISPRepeater)&&(deviceSection.fields.push({name:"dcc_smr_client",value:manualProfile.$WifiClientStep.SSID}),addFileLine("dcc_smr_client",manualProfile.$WifiClientStep.SSID)),result.push(deviceSection),profile.containLAN()&&(result.push({name:"LAN",fields:[{name:"ip_address",value:native.Config.LAN[1].IPv4.StaticIP[1].Address},{name:"subnet_mask",value:native.Config.LAN[1].IPv4.StaticIP[1].SubnetMask}]}),addFileLine("LAN"),addFileLine("ip_address",native.Config.LAN[1].IPv4.StaticIP[1].Address),addFileLine("subnet_mask",native.Config.LAN[1].IPv4.StaticIP[1].SubnetMask),addFileBR()),native.Config.SystemPassword&&_.size(native.Config.SystemPassword.Password)&&result.push({name:"dcc_smr_syspass",fields:[{name:"username",value:native.Config.SystemPassword.Login},{name:"password",value:native.Config.SystemPassword.Password,hidden:!0}]}),native.Config.SystemTime&&native.Config.SystemTime.TimeZone&&(timeZone=parseInt(native.Config.SystemTime.TimeZone),timeZoneUTC=timeZone>=0?"GMT+"+timeZone:"GMT"+timeZone,result.push({name:translate("dcc_timezone")+": "+timeZoneUTC,fields:[]})),result},$scope.services=function(config){var services;return config.VLAN?config.VLAN.groups.all:config.GroupingInterfaces?(services=[],_.each(config.GroupingInterfaces,function(group){console.log("group",group);var name=group.create.name;_.each(group.create.lans,function(port){services.push({name:port,service:name.toLowerCase()})})}),services):void 0}($scope.nativeData.Config),$scope.apply=function(){if(!$scope.applying){$scope.applying=!0;var native=$scope.nativeData;return native.Config.rootIsWIFIClient=$rootScope.rootIsWIFIClient?1:0,isApMode&&!confirm(translate("dcc_ap_will_lost"))?void($scope.applying=!1):void function(){function applyError(){stepManager.action("apply",{error:!0}),$scope.showOverlay(!1)}function getDuration(res){return 200==res.status&&res.data.result?res.data.result.duration:null}$scope.showOverlay(!0),native.Config.VoIP&&native.Config.VoIP.__Skip&&delete native.Config.VoIP,profiles.apply(native).then(function(res){getDuration(res)?($rootScope.gApplyDuration=getDuration(res),$timeout(function(){stepManager.action("apply"),$scope.showOverlay(!1)},5e3),$rootScope.dlinkMobileApp.isUserInMobileApp()&&$rootScope.dlinkMobileApp.wizardCompleted&&$rootScope.dlinkMobileApp.wizardCompleted(native)):applyError()})["catch"](applyError)}()}},$scope.customPrevStep=function(){dataShare.isSet("ManualProfile")?stepManager.action("prev",{fromManual:!0}):$stateParams.prev?$state.go($stateParams.prev):stepManager.action("prev",{})},$scope.summary=[],devinfo.onceAndSubscribe("version|net",onData)}]);