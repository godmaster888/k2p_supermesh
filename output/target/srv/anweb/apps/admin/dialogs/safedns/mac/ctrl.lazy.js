"use strict";function SafeDNSAccountMacDialogCtrl($scope,somovd,funcs,snackbars,device,nwClientListUtil){function wasModified(){return initModel&&!_.isEqual(workModel.mac,initModel.mac)}function isFormValid(){return $scope.dialog_form.$valid}function getProfileList(){return util.getProfileList({__pid:workModel.__pid,__aid:workModel.mac.__aid})}var util=device.safeDns;$scope.ngDialogData.defProfile||null;var initModel=null,workModel={mac:funcs.deepClone($scope.ngDialogData.mac)||{},macList:$scope.ngDialogData.macList||[],accountList:$scope.ngDialogData.accountList||[],profileList:$scope.ngDialogData.profileList||[],defProvider:$scope.ngDialogData.defProvider,isActivate:!1},clients=[];workModel.isNew=!(workModel.mac&&workModel.mac.__id),workModel.header=workModel.isNew?"act_adding":"act_editing",$scope.model=workModel,$scope.modelFuncs={save:function(){isFormValid()&&(workModel.mac.hostname=workModel.mac.hostname?workModel.mac.hostname:"",console.log("save mac",workModel.mac),$scope.closeThisDialog({status:"save",data:workModel.mac}))},isSavingDisabled:function(){return!wasModified()&&!workModel.isNew},wasModified:wasModified,getProfileList:getProfileList},$scope.valid={host:function(value){var host=workModel.mac||{};return _.some(workModel.macList,function(item){return item.hostname&&item.hostname==value&&item.__id!=host.__id})?"msg_error_value_is_not_uniq":null},mac:function(value){var mac=workModel.mac||{};return _.some(workModel.macList,function(item){return item.address.toUpperCase()==value.toUpperCase()&&item.__id!=mac.__id})?"msg_error_value_is_not_uniq":null}},!workModel.mac.__aid&&workModel.accountList.length&&(workModel.mac.__aid=_.first(workModel.accountList).__id);var _profileList=getProfileList();!workModel.mac.__pfid&&_profileList.length&&(workModel.mac.__pfid=_.first(_profileList).__id),initModel=funcs.deepClone(workModel),workModel.isActivate=!0,$scope.$emit("pageload"),$scope.$watch("model.mac.address",function(mac){var client;mac&&(client=_.find(clients,function(client){return client.mac==mac}),client&&client.hostname&&($scope.model.mac.hostname=client.hostname))}),nwClientListUtil.pull().then(function(result){clients=result.clients})}angular.module("app").controllerProvider.register("SafeDNSAccountMacDialogCtrl",SafeDNSAccountMacDialogCtrl);