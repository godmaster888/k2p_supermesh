"use strict";function DHCPOptionsDialogCtrl($scope,funcs,dhcpCustomOpts,translate){var options=$scope.ngDialogData,iface=$scope.device.lan["interface"].getCurrent();$scope.knownOptions=dhcpCustomOpts,$scope.DHCPOption={data:{Option:"",Value:"",Tag:"",Force:!1},tmp:{option:"",tag:"",force:!1},initData:null,instance:void 0,init:function(util,data,instance){this.isNew=data?!1:!0,self=this,this.util=util,void 0!=instance&&(this.instance=instance),this.initData=angular.copy(this.data),this.usedValues=this.util.usedValues(this.instance),$scope.getInitOption=function(){var opt,index;return data?(self.data.Value=data.Value,self.data.Force=data.Force,opt=_.findWhere($scope.knownOptions,{option:$scope.DHCPOption.getOptionName(data.Tag)}),index=_.indexOf($scope.knownOptions,opt),$scope.knownOptions[index]):$scope.knownOptions[0]}},isUsedRule:function(tag){return _.contains(this.usedValues.Tag,tag)?"msg_error_rule_is_not_uniq":null},validation:function(value,param){function isNumber(data){var patt_number=/(^-?[0-9]+$)/;return patt_number.test(data)?!0:!1}function isAscii(str){return/^[\000-\177]*$/.test(str)}function isHex(data){var patt_hex=/(^(0x)?[0-9a-fA-F]+$)/;return patt_hex.test(data)?!0:!1}value&&(value=value.replace(/(^\s+|\s+$)/g,""));var ipList,i,ipMask,tempArr,temp,elemCount,netPrefix,gw,net,prefix,mask,ipIp,regHostname,domainList,hostList,hexArr,findElem,errors=[];switch(param||value&&errors.push("dhcp_options_not_selected"),value&&value.length>64&&errors.push(translate("msg_maxlength_symb")+" 64"),param){case"mask":value&&!funcs.is.mask(value)&&errors.push("msg_invalid_mask");break;case"ip":value&&!funcs.is.ipv4(value)&&errors.push("msg_invalid_ipv4");break;case"moreIP":if(value){var ipList=value.split(",");ipList.length>_.uniq(ipList).length&&errors.push("dhcp_options_invalid_value");for(var i=0;i<ipList.length;i++)funcs.is.ipv4(ipList[i])||errors.push("dhcp_options_invalid_value")}break;case"moreIPOr0":if(value&&"0"!=value){ipList=value.split(","),ipList.length>_.uniq(ipList).length&&errors.push("dhcp_options_invalid_value");for(var i=0;i<ipList.length;i++)funcs.is.ipv4(ipList[i])||errors.push("dhcp_options_invalid_value")}break;case"ipMask":value&&(ipMask=value.split("/"),(!funcs.is.ipv4(ipMask[0])||!isNumber(ipMask[1])||ipMask[1]<1||ipMask[1]>32)&&errors.push("dhcp_options_invalid_value"));break;case"ipMaskIp":if(value){tempArr=value.split(","),tempArr.length&&tempArr.length%2!=0&&errors.push("dhcp_options_invalid_value"),temp=[],elemCount=0;for(var i=0;i<tempArr.length/2;i++)temp[i]=tempArr[elemCount]+","+tempArr[elemCount+1],elemCount+=2;temp.length>_.uniq(temp).length&&errors.push("dhcp_options_invalid_value");for(var i=0;i<temp.length;i++)netPrefix=temp[i].split(",")[0],gw=temp[i].split(",")[1],net=netPrefix.split("/")[0],prefix=netPrefix.split("/")[1],mask=funcs.ipv4.mask["long"](prefix),netPrefix&&gw||errors.push("dhcp_options_invalid_value"),net&&prefix&&(net!=funcs.ipv4.subnet.getNetworkAddress(net,mask)||!isNumber(prefix)||1>prefix||prefix>32||!funcs.is.ipv4(gw)||gw==funcs.ipv4.subnet.getNetworkAddress(net,mask))&&errors.push("dhcp_options_invalid_value")}break;case"ipIp":value&&(ipIp=value.split(","),funcs.is.ipv4(ipIp[0])&&funcs.is.ipv4(ipIp[1])&&ipIp[0]!=ipIp[1]||errors.push("dhcp_options_invalid_value"));break;case"domain":value&&!funcs.is.hostname(value)&&errors.push("msg_invalid_domain");break;case"hostname":regHostname=/^([a-zA-Zа-яА-Я]([а-яА-Яa-zA-Z0-9\-]{0,62}[а-яА-Яa-zA-Z0-9]){0,1})$/,value=value.replace(/(^\s+|\s+$)/g,""),value&&!regHostname.test(value)&&errors.push("msg_invalid_hostname");break;case"vendor":break;case"moreDomain":if(value){domainList=_.compact(value.split(",")),domainList.length>_.uniq(domainList).length&&errors.push("dhcp_options_invalid_value");for(var i=0;i<domainList.length;i++)funcs.is.domain(domainList[i])||errors.push("dhcp_options_invalid_value")}break;case"moreHost":if(value)for(hostList=_.compact(value.split(",")),hostList.length>_.uniq(hostList).length&&errors.push("dhcp_options_invalid_value"),i=0;i<hostList.length;i++)funcs.is.domain(hostList[i])||funcs.is.ipv4(hostList[i])||errors.push("dhcp_options_invalid_value");break;case"host":!value||funcs.is.domain(value)||funcs.is.ipv4(value)||errors.push("msg_invalid_host");break;case"string":value&&!isAscii(value)&&errors.push("dhcp_options_invalid_value");break;case"hex":value&&(hexArr=value.split(":"),findElem=_.find(hexArr,function(elem){return 2!=elem.length||!isHex(elem)}),void 0!=findElem&&errors.push("dhcp_options_invalid_value"));break;case"bool":value&&"0"!=value&&"1"!=value&&errors.push("dhcp_options_invalid_value");break;case"8unsig":value&&(!isNumber(value)||0>value||value>255)&&errors.push("dhcp_options_invalid_value");break;case"16unsig":value&&(!isNumber(value)||0>value||value>65535)&&errors.push("dhcp_options_invalid_value");break;case"16unsigMin576":value&&(!isNumber(value)||576>value||value>65535)&&errors.push("dhcp_options_invalid_value");break;case"16unsigMin68":value&&(!isNumber(value)||68>value||value>65535)&&errors.push("dhcp_options_invalid_value");break;case"32unsig":value&&(!isNumber(value)||0>value||value>4294967295)&&errors.push("dhcp_options_invalid_value");break;case"32sig":value&&(!isNumber(value)||-2147483648>value||value>2147483647)&&errors.push("dhcp_options_invalid_value");break;case"32sigMin0":value&&(!isNumber(value)||0>value||value>2147483647)&&errors.push("dhcp_options_invalid_value")}return errors.length?errors[0]:null},getOptionName:function(tag){var elem=_.find(dhcpCustomOpts,function(item){return item.tag==tag});return elem?elem.option:""},changeOpt:function(tmp){this.data.Tag=tmp.tag},isChange:function(){return!_.isEqual(this.initData,this.data)}},$scope.DHCPOption.dialog={action:options.action,data:{},onApply:function(){$scope.form.$valid&&(this.data.Value=$scope.DHCPOption.data.Value,this.data.Option=$scope.DHCPOption.tmp.option,this.data.Tag=$scope.DHCPOption.tmp.tag,this.data.Type=$scope.DHCPOption.tmp.type,this.data.Force=$scope.DHCPOption.data.Force,$scope.closeThisDialog({action:this.action,data:this.data,instance:$scope.DHCPOption.instance}))},onCancel:function(){$scope.closeThisDialog(null)}},$scope.DHCPOption.init(iface.ipv4.dhcp.DHCPOption,options.data,options.instance)}