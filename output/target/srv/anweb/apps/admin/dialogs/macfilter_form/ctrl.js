"use strict";function MacFilterFormDialogCtrl($scope,funcs,translate,util){function activate(){$scope.dialog.config=util.getConfig(),$scope.dialog.attrs=util.getAttrs(),helper=util.makeHelper(),_.isUndefined(index)?($scope.dialog.action="add",$scope.dialog.header=translate("macflt_add_rule"),$scope.dialog.rule=helper.getDefaultRule($scope.dialog.config,$scope.dialog.attrs)):($scope.dialog.action="edit",$scope.dialog.header=translate("macflt_edit_rule"),$scope.dialog.rule=angular.copy(rule),__backupRule=angular.copy($scope.dialog.rule))}function save(){function checkChange(changedConfig){return helper.accessWillLost(changedConfig)?(alert(translate("macflt_warn_access")),Promise.reject()):Promise.resolve(changedConfig)}if($scope.form.$valid){var changedConfig=helper.changeConfig($scope.dialog.config,{editRules:{rule:$scope.dialog.rule,index:index}}),overlayId=overlay.start();$scope.dialog.disableButtons=!0,util.getClient().then(function(clientConfig){return clientConfig&&clientConfig.Client&&(changedConfig.Client=clientConfig.Client),Promise.resolve(changedConfig)}).then(checkChange).then(function(changedConfig){return $scope.closeThisDialog({changed:changedConfig,overlayId:overlayId})})["catch"](function(){$scope.dialog.disableButtons=!1,overlay.stop(overlayId)})}}function remove(){function checkChange(changedConfig){return helper.accessWillLost(changedConfig)&&!alert(translate("macflt_warn_access"))?Promise.reject():Promise.resolve(changedConfig)}var changedConfig=helper.changeConfig($scope.dialog.config,{removeIndexes:[index]}),overlayId=overlay.start();$scope.dialog.disableButtons=!0,util.getClient().then(function(clientConfig){return clientConfig&&clientConfig.Client&&(changedConfig.Client=clientConfig.Client),Promise.resolve(changedConfig)}).then(checkChange).then(function(changedConfig){return $scope.closeThisDialog({changed:changedConfig,overlayId:overlayId})})["catch"](function(){$scope.dialog.disableButtons=!1,overlay.stop(overlayId)})}function getUsedMacList(){return helper.getUsedMacList($scope.dialog.config,index)}function isNotUniqRule(){return helper.isNotUniqRule($scope.dialog.config,$scope.dialog.rule,index)}function wasModified(){return __backupRule&&!_.isEqual(__backupRule,$scope.dialog.rule)}var rule=$scope.ngDialogData.rule,index=$scope.ngDialogData.index,overlay=$scope.overlay.circular,overNames=_.pluck($scope.ngDialogData.overRules,"Name");$scope.dialog={header:"",action:null,rule:null,config:null,disableButtons:!1,save:save,remove:remove,close:function(){$scope.closeThisDialog(null)},getActionList:function(){return[{name:"act_allow",value:"ACCEPT"},{name:"act_deny",value:"DROP"}]},getUsedMacList:getUsedMacList,isSupported:function(param){return _.has($scope.dialog.rule,param)},isDisabledSave:function(){return $scope.dialog.disableButtons||"edit"==$scope.dialog.action&&!wasModified()||isNotUniqRule()},isDisabledRemove:function(){return $scope.dialog.disableButtons},isNotUniqRule:isNotUniqRule,wasModified:wasModified,checkNames:function(){return _.contains(overNames,$scope.dialog.rule.Name)?"name_exists":null}},rule&&($scope.useSchedule=rule.useSchedule?rule.useSchedule:!1);var helper,__backupRule=null;activate()}MacFilterFormDialogCtrl.$inject=["$scope","funcs","translate","macFilterUtil"];