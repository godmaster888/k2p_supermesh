"use strict";!function(){angular.module("app").controller("RequestPinCtrl",function($scope,snackbars,translate,USBModemUtil){function saveCb(response){var isSuccess=_.find(response.result.ParameterList,{Name:"Success"});isSuccess.Value?$scope.closeThisDialog({change:!0}):errorPIN()}function errorPIN(){snackbars.add("usb_modem_pin_request_wrong");var input={modem:data.modem,sim:data.sim,param:"PIN"};util.updateSIMInfo(input).then(function(response){data.pin=response,0==data.pin.PIN&&$scope.closeThisDialog(),$scope.Attempts=getAttempts()},errorPush)}function errorPush(){snackbars.add("msg_rpc_write_error")}function getAttempts(){return translate("usb_modem_pin_attempt")+": "+(-1!=data.pin.PIN?data.pin.PIN:translate("unknown"))}$scope.PIN="";var data=angular.copy($scope.ngDialogData.data),util=USBModemUtil;$scope.Attempts=getAttempts(),$scope.validationPIN=function(pin){if(!pin)return null;var re=/^[0-9]{4,8}$/g;return re.test(pin)?null:"usb_modem_pin_code_wrong"},$scope.action=function(){return translate(data&&data.pin.Locked?"act_disable":"act_enable")},$scope.isButtonDisabled=function(){return $scope.requestPIN.$invalid||""==$scope.PIN},$scope.save=function(){var overlay=$scope.overlay.circular,overlayId=overlay.start(),input={modem:data.modem,sim:data.sim,pin:$scope.PIN,locked:!data.pin.Locked};util.lockedPIN(input).then(saveCb)["catch"](errorPush)["finally"](overlay.stop.bind(overlay,overlayId))}})}();