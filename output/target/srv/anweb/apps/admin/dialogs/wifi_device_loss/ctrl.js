"use strict";function WifiDeviceLossDialogCtrl($rootScope,$scope,$timeout,translate,devinfo){function startProgressBar(){$scope.pbDuration=2e4,$scope.pbPause=!1,$scope.pbHidden=!1}function stopProgressBar(){$scope.pbHidden=!0}function stateForMobileApp(){startProgressBar(),$scope.mobileapp=!0,$scope.waitForConnection=!0,$scope.updateCommentTitle()}function stateNotMobileApp(){stopProgressBar(),$scope.mobileapp=!1,$scope.updateCommentTitle()}var data=$scope.ngDialogData;$scope.updateCommentTitle=function(){var msg=[],reason=[];_.contains(data.reason,"ssid")&&reason.push("wifi_device_loss_ssid"),_.contains(data.reason,"security_mode")&&reason.push("wifi_device_loss_security_mode"),_.contains(data.reason,"security_encryption")&&reason.push("wifi_device_loss_security_encryption"),msg.push($scope.mobileapp&&$scope.waitForConnection?"wifi_device_loss_reconnect_attempt":$scope.deviceAvailable?"wifi_device_loss_reconnect_success":$scope.mobileapp?"wifi_device_loss_reconnect_failed":"wifi_device_loss_reconnect"),$scope.commentReason=reason,$scope.commentTitle=msg,$scope.updateParams()},$scope.getCommentParam=function(){return translate("wifi_device_loss_params")+":\n"},$scope.updateParams=function(){function getKey(name){return/WEPKey*/.test(name)?"wifi_wep_key"+name.slice(6):{SSID:"wifi_ssid",ModeEnabled:"wifi_mode",PreSharedKey:"wifi_psk_key",RadiusSecret:"wifi_wpa_radius_secret"}[name]}var msg=[];_.each(data.params,function(value,name){var key;value&&(key=getKey(name),key&&msg.push({key:key,value:value}))}),$scope.params=msg},$scope.skip=function(){$scope.closeThisDialog()},$scope.openWifiSettings=function(){$rootScope.dlinkMobileApp.openWifiSettings()},$timeout(function(){function setDeviceNotAvailable(){$scope.deviceAvailable=!1,$scope.waitForConnection||$scope.updateCommentTitle()}function setDeviceAvailableAgain(){devinfo.once("client").then(function(result){result.client.SSID==data.params.SSID&&($scope.deviceAvailable=!0,$scope.waitForConnection=!1,stopProgressBar(),$scope.updateCommentTitle())})}var eventDeviceNotAvailable=$rootScope.$on("device.state.not_available",setDeviceNotAvailable),eventDeviceAvailableAgain=$rootScope.$on("device.state.available_again",setDeviceAvailableAgain),eventDeviceAvailableAgain2=$rootScope.$on("device_available_again",setDeviceAvailableAgain),eventDeviceDefinitlyLost=$rootScope.$on("device_definitly_lost",setDeviceNotAvailable),eventDevicePossiblyLost=$rootScope.$on("device_possibly_lost",setDeviceNotAvailable);$scope.$on("$destroy",function(){eventDeviceNotAvailable(),eventDeviceAvailableAgain(),eventDeviceAvailableAgain2(),eventDeviceDefinitlyLost(),eventDevicePossiblyLost()})}),$rootScope.dlinkMobileApp?$rootScope.dlinkMobileApp.wifiConnectionChanged(data.params).then(function(){stateForMobileApp()})["catch"](function(){stateNotMobileApp()}):stateNotMobileApp(),$scope.wifiReconnectTimeout=function(status){"finished"==status&&(stopProgressBar(),$scope.waitForConnection=!1,$scope.updateCommentTitle())}}WifiDeviceLossDialogCtrl.$inject=["$rootScope","$scope","$timeout","translate","devinfo"];