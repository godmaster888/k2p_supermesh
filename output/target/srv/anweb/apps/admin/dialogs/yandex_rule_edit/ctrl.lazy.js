"use strict";!function(){function yandexRuleDialogController($scope,device,translate,funcs,util){function ruleMap(rule){return rule?_.pick(rule,"ip","mac","host","mode","isKnown"):null}$scope.focus=!1,$scope.model=funcs.deepClone($scope.ngDialogData.rule),$scope.allRules=$scope.ngDialogData.rules,$scope.ydModesAvailable=util.getAvailableModes(),$scope.isManyIpAddresses=function(){return $scope.model.ipList&&$scope.model.ipList.length>1},$scope.model.isNew?$scope.model.isNew&&$scope.isManyIpAddresses()?$scope.rules=_.map(_.where(util.getConfig().clients,{mac:$scope.model.mac}),ruleMap):$scope.model.isNew&&!$scope.isManyIpAddresses()&&($scope.rules=[$scope.model]):$scope.rules=_.map(_.where(util.getConfig().rules,{mac:$scope.model.mac}),ruleMap),$scope.validHost=function(value){var rules=$scope.allRules||{},rule=$scope.model||{};return _.some(rules,function(elem){return elem.host&&elem.host==value&&elem.__id!=rule.__id})?"msg_error_value_is_not_uniq":null},$scope.validMac=function(value){var rules=$scope.allRules||{},rule=$scope.model||{};return _.some(rules,function(elem){return elem.mac&&elem.mac==value&&elem.__id!=rule.__id})?"msg_error_value_is_not_uniq":null},$scope.list=[],_.each($scope.rules,function(rule){$scope.list.push(rule.ip)}),$scope.saveRule=function(){if(!$scope.yandex_rule_edit.$invalid){var readyRules=[];_.each($scope.list,function(ip){var rule={mode:$scope.model.mode,host:$scope.model.host,mac:$scope.model.mac,__id:$scope.allRules[0]?(+_.last($scope.allRules).__id+1).toString():"0",ip:ip};readyRules.push(rule)}),$scope.closeThisDialog(readyRules)}},$scope.removeRule=function(){$scope.rules=[],$scope.closeThisDialog($scope.rules)},$scope.isEmptyIpField=function(){var isEmpty=!1;return _.each($scope.rules,function(rule){(!rule.ip||$scope.yandex_rule_edit.ipField.$invalid)&&(isEmpty=!0)}),isEmpty},$scope.needIP=function(){return!autoconf.BR2_PACKAGE_ANWEB_DSYSINIT}}angular.module("app").controllerProvider.register("yandexRuleDialogController",yandexRuleDialogController),yandexRuleDialogController.$inject=["$scope","device","translate","funcs","yandexDnsRulesUtil"]}();