"use strict";function DnsHostsDialogCtrl($scope,funcs){function validName(name){return~_.indexOf(useHostnames,name)?"msg_error_value_is_not_uniq":$scope.ngDialogData.checkStaticAddr&&_.contains(useStaticAddress,name)?"msg_error_value_is_not_uniq":null}function isIPv6(ip){return""==ip?!0:ip&&funcs.is.ipv6(ip)}function wasModified(){return workModel.isActivate&&!_.isEqual(workModel.host,initModel.host)}function isFormValid(){return $scope.dialog_form.$valid}var iface,host=_.clone($scope.ngDialogData.host||{host:{ip:"",hostname:""}}.host),useHostnames=_.without($scope.ngDialogData.allHostnames,host.hostname)||[],useStaticAddress=[];$scope.ngDialogData.checkStaticAddr&&(iface=$scope.device.lan["interface"].getCurrent(),useStaticAddress=function(){var staticAddress=iface[$scope.ngDialogData.version].dhcp.staticAddress,hostnames=staticAddress.usedValues().Hostname;return _.compact(hostnames)}());var useIps=_.clone($scope.ngDialogData.allIps),initModel=null,workModel={host:host,isNew:!$scope.ngDialogData.host,isActivate:!1,ipVersion:_.clone($scope.ngDialogData.version||"all"),useIps:useIps};workModel.header="dns_hosts_"+(workModel.isNew?"add":"edit"),$scope.model=workModel,$scope.funcs={save:function(){isFormValid()&&$scope.closeThisDialog({status:"save",host:host})},getUseIps:function(){return _.map(useIps,function(ip){return{ip:ip}})},isSavingDisabled:function(){return!workModel.isNew&&!wasModified()}},$scope.valid={name:validName,ip:function(ip,type){return~_.indexOf(useIps,ip)?"msg_error_value_is_not_uniq":type&&"ipv6"==type&&!isIPv6(ip)?"msg_invalid_ipv6":null}},function(){initModel={host:funcs.deepClone(workModel.host)},workModel.isActivate=!0,$scope.$emit("pageload")}()}angular.module("app").controllerProvider.register("DnsHostsDialogCtrl",DnsHostsDialogCtrl);