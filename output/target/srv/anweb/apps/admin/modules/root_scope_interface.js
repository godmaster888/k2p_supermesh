"use strict";!function(){angular.module(regdep("root-scope-interface"),["app.page-details"]).run(["$rootScope","$q","overlay-simple","overlay-progress","ngDialog","devinfo","$timeout","$interval","$http","navigationFilter","pageDetails","unloadHandler",function($rs,$q,overlaySimple,overlayProgress,ngDialog,devinfo,$timeout,$interval,$http,navigationFilter,pageDetails,unloadHandler){$rs.autoconf=autoconf,$rs.appEvents={notifications:[]};var appEvents=$rs.appEvents;$rs.pageReady=!1,$rs.$on("notification",function(){function prepareNotification(obj){function nextNotification(inx){function getNextNotice(notifications,inx){if(notifications){var maxPriorityNotification,pullNotices=_.without(notifications,notifications[inx]);if(pullNotices.length){var maxPriorityNotice=_.max(pullNotices,function(e){return e.priority});return _.isObject(maxPriorityNotice)&&(maxPriorityNotification=_.filter(pullNotices,function(e,k){return e.priority==maxPriorityNotice.priority&&k>=inx}),maxPriorityNotification.length>0&&(maxPriorityNotice=_.first(maxPriorityNotification))),_.isObject(maxPriorityNotice)?maxPriorityNotice:notifications[inx+1]}}}inx>appEvents.notifications.length-2?delete appEvents.trayNotification:appEvents.trayNotification=getNextNotice(appEvents.notifications,inx)}function wrapAction(actionObj,actionName,handler){var action=actionObj[actionName];actionObj[actionName]=function(){var actionResult,inx=_.findIndex(appEvents.notifications,function(e){return e.name==obj.name}),inTray=!1;appEvents.trayNotification&&appEvents.trayNotification.name==obj.name&&(inTray=!0,delete appEvents.trayNotification),_.isFunction(action)?(actionResult=action.call(actionObj),actionResult&&_.isFunction(actionResult.then)?actionResult.then(function(result){handler(result,inTray,inx)})["catch"](function(){handler(!1,inTray,inx)}):handler(actionResult,inTray,inx)):handler(!0,inTray,inx)}}return wrapAction(obj,"close",function(result,inTray,inx){result&&inTray&&nextNotification(inx)}),obj.actions&&_.each(obj.actions,function(e){wrapAction(e,"handler",function(result,inTray,inx){inTray&&nextNotification(inx),inx>=0&&result&&appEvents.notifications.splice(inx,1)})}),obj}var arg=arguments[1];if(arg){_.isArray(arg)||(arg=[arg]),_.each(arg,function(e){appEvents.notifications.push(prepareNotification(e))});var firstNotification=function(notifications){var maxPriorityNotice=_.max(notifications,function(e){return e.priority});return _.isObject(maxPriorityNotice)?maxPriorityNotice:notifications[notifications.length-1]}(appEvents.notifications);appEvents.trayNotification&&appEvents.trayNotification.name==firstNotification.name||(appEvents.trayNotification=firstNotification)}}),$rs.$on("notification-remove",function(){var arg=arguments[1];arg&&(_.isArray(arg)||(arg=[arg]),_.each(arg,function(e){var noticeIndex=_.findIndex(appEvents.notifications,function(notice){return notice.name==e.name});-1!=noticeIndex&&appEvents.notifications.splice(noticeIndex,1)}),function(){function getNextNotice(notifications){if(notifications){var maxPriorityNotice=_.max(notifications,function(e){return e.priority});return _.isObject(maxPriorityNotice)?maxPriorityNotice:notifications[0]}}appEvents.notifications.length?appEvents.trayNotification=getNextNotice(appEvents.notifications):delete appEvents.trayNotification}())}),$rs.$on("pageload",function(){$rs.overlay.preloader.stop()}),$rs.$on("stateChangeBreak",function(){$rs.overlay.preloader.stop()}),$rs.overlay={circular:{start:function(){var id=Math.floor(999*Math.random())+1;return overlaySimple.start({event:id}),id},stop:function(id,force){overlaySimple.stop({event:id,force:force})}},progress:{start:function(duration,title,startPosition){var deferred=$q.defer();return overlayProgress.start({duration:duration,callback:function(status){"finished"==status&&deferred.resolve()},title:title,startPosition:startPosition?startPosition:null}),deferred.promise},stop:function(){overlayProgress.stop()}},preloader:{start:function(){$rs.pageReady=!1},stop:function(){$rs.pageReady=!0}}},$rs.waitForReboot=function(){function updateRows(data){null!=data&&($timeout.cancel(promise),deffered.resolve(data))}var deffered=$q.defer(),promise=$timeout(function(){devinfo.skipAuth.subscribe("version",updateRows)},15e3);return deffered.promise},$rs.customRules=navigationFilter.rules(),$rs.goToNewIP=function(ip){var oldUrl=location.href,newUrl=oldUrl.replace(/(\:\/\/)([^:\/]*)/,function(str,p1){return p1+ip});unloadHandler.before.clean(),newUrl==oldUrl?location.reload():location.href=newUrl},$rs.pageDetails=pageDetails,$rs.portsDefer=$q.defer()}])}();