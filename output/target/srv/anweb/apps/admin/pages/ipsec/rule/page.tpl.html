<div class="main-card"><form name="form" class="css-form" novalidate nw-form unsaved-warning-form nw-form-autocomplete-off ng-submit="ipsec.apply()" unsaved-backup-status="{{!ipsec.wasModified()}}"><div class="card-content" ng-if="ipsec.isActivate"><div nw-labeled-switch nw-label="act_enable" nw-model="ipsec.rule.enable" nw-change="ipsec.changeEnabled()" ng-if="ipsec.support('enable')"></div><div class="row-grid bottom-space"><div class="col-md-12"><div class="card-title" ng-bind="'general_settings' | translate"></div></div><div class="col-md-6 block-left"><div nw-field nw-label="ip_version"><select ng-model="ipVersion.value" ng-options="version | translate for version in ipVersion.list"></select></div><div nw-labeled-switch nw-label="ipsec_anonymous" nw-model="ipsec.rule.anonymous" ng-if="ipsec.support('anonymous')"></div><div nw-field nw-label="ipsec_ident_type" ng-if="ipsec.support('peer_type') && !ipsec.rule.anonymous"><select ng-model="ipsec.rule.peer_type" ng-options="option.value as (option.name | translate) for option in ipsec.getFilterList('my_ident', ipsec.rule)" ng-change="ipsec.changePeerType(ipsec.rule.peer_type)"></select></div><div nw-field nw-label="ipsec_peer" nw-required nw-disabled="ipsec.rule.anonymous" ng-if="ipsec.rule.peer_type == 1 && ipVersion.value == 'ipv4'"><input ng-model="ipsec.rule.peer" nw-type="ipv4"></div><div nw-field nw-label="ipsec_peer" nw-required nw-disabled="ipsec.rule.anonymous" ng-if="ipsec.rule.peer_type == 1 && ipVersion.value == 'ipv6'"><input ng-model="ipsec.rule.peer" nw-type="ipv6"></div><div nw-field nw-label="ipsec_peer" nw-required nw-disabled="ipsec.rule.anonymous" ng-if="ipsec.rule.peer_type != 1 && autoconf.BR2_PACKAGE_ANWEB_DSYSINIT"><input ng-model="ipsec.rule.peer" nw-type="domain" nw-not-cyrillic-char></div><div nw-field nw-label="ipsec_identifier" ng-if="ipsec.support('my_ident')"><select ng-model="ipsec.rule.my_ident" ng-options="option.value as (option.name | translate) for option in ipsec.getFilterList('my_ident', ipsec.rule)"></select></div><div nw-field nw-label="ipsec_id_val" nw-required ng-if="ipsec.rule.my_ident == 1"><input nw-type="ip" ng-model="ipsec.rule.my_ident_value" nw-custom-valid="ipsec.checkUniqueAndLength(ipsec.rule.my_ident_value, 128)"></div><div nw-field nw-label="ipsec_id_val" nw-required ng-if="ipsec.rule.my_ident != 1"><input ng-model="ipsec.rule.my_ident_value" nw-custom-valid="ipsec.checkUniqueAndLength(ipsec.rule.my_ident_value, 128)"></div><div nw-field nw-label="ipsec_key" nw-required nw-disabled="ipsec.rule.auth && ipsec.rule.auth != 'psk'"><input type="password" ng-model="ipsec.rule.key" nw-eye nw-custom-valid="ipsec.validation(value, 128)"></div><div nw-field nw-label="ipsec_local_wan" ng-if="ipsec.support('leftType')"><select ng-model="ipsec.rule.leftType" ng-options="option.value as (option.name | translate) for option in ipsec.getList('left_type')"></select></div><div nw-field nw-label="iface" nw-required ng-if="ipsec.rule.leftType == 'iface'"><select ng-model="ipsec.rule.leftIface" ng-options="option.value as (option.name | translate) for option in ipsec.getList('left_iface')"></select></div><div nw-field nw-label="wan_group" nw-required ng-if="ipsec.rule.leftType == 'group' && ipsec.rule.devMode == 'Firewall'"><select ng-model="ipsec.rule.leftGroup" ng-options="option.value as (option.name | translate) for option in ipsec.getList('left_group')"></select></div><div nw-field nw-label="ipsec_nat_traversal"><select ng-model="ipsec.rule.nat_t" ng-options="option.value as ipsec.getName(option.name) | translate for option in ipsec.getList('nat_t')"></select></div><div nw-field nw-label="ipsec_tunnel_type" ng-if="ipsec.support('type')"><select ng-model="ipsec.rule.type" ng-options="option.value as (option.name | translate) for option in ipsec.getList('type')"></select></div><div nw-labeled-switch nw-label="ipsec_router_ipsec" nw-model="ipsec.rule.router_ipsec" ng-if="autoconf.BR2_PACKAGE_ANWEB_DSYSINIT && ipsec.rule.type != 'transport' && ipsec.rule.devMode != 'Firewall'"></div><div nw-labeled-switch nw-label="ipsec_use_mtu" nw-model="ipsec.rule.useMTU" ng-if="ipsec.support('useMTU')"></div></div><div class="col-md-6 block-right"><div nw-field nw-label="ipsec_ex_mode" ng-if="ipsec.support('exchange_mode')"><select ng-model="ipsec.rule.exchange_mode" ng-options="option.value as (option.name | translate) for option in ipsec.getFilterList('exchange_mode', ipsec.rule)"></select></div><div class="note" ng-bind="'ipsec_dpd_comment' | translate"></div><div nw-labeled-switch nw-label="ipsec_enable_dpd" nw-model="ipsec.rule.enableDPD" nw-change="ipsec.changeEnableDPD()"></div><div nw-field nw-label="ipsec_dead_peer_delay" nw-required nw-disabled="!ipsec.rule.enableDPD"><input nw-number nw-min="5" nw-max="360" ng-model="ipsec.rule.dpd_delay"></div><div nw-field nw-label="ipsec_dead_peer_timeout" nw-required nw-disabled="!ipsec.rule.enableDPD" ng-if="ipsec.support('dpd_timeout')"><input nw-number nw-min="0" nw-max="86400" ng-model="ipsec.rule.dpd_timeout"></div><div nw-field nw-label="ipsec_dead_peer_max_fail" nw-required nw-disabled="!ipsec.rule.enableDPD" ng-if="ipsec.support('dpd_maxfail')"><input nw-number nw-min="2" nw-max="50" ng-model="ipsec.rule.dpd_maxfail"></div><div nw-field nw-label="TCP MSS" ng-if="ipsec.support('tcpmss')"><select ng-model="ipsec.rule.tcpmss" ng-options="option.value as (option.name | translate) for option in ipsec.getList('tcpmss')"></select></div><div nw-field nw-label="ipsec_tcp_mss_value" nw-required nw-disabled="ipsec.rule.tcpmss == 2" ng-if="ipsec.support('tcpmss_value')"><input nw-number nw-min="576" nw-max="1500" ng-model="ipsec.rule.tcpmss_value"></div><div nw-labeled-switch nw-label="ipsec_allow_traffic" nw-model="ipsec.rule.enable_routing" ng-if="ipsec.support('enable_routing')"></div></div></div><div class="row-grid bottom-space"><div class="col-md-6 block-left"><div class="card-title" ng-bind="'ipsec_first_phase' | translate"></div><div nw-field nw-label="ipsec_mode" ng-if="ipsec.support('modeIKE') && ipsec.showMode(ipsec.rule.alg)"><select ng-model="ipsec.rule.modeIKE" ng-options="option.value as (option.name | translate) for option in ipsec.getList('ike_crypto_mode')"></select></div><div nw-field nw-label="ipsec_size_key" ng-if="ipsec.support('sizeKeyIKE') && ipsec.showSizeKey(ipsec.rule.alg)"><select ng-model="ipsec.rule.sizeKeyIKE" ng-options="option for option in ipsec.getList('ike_crypto_skey')"></select></div><div nw-field nw-label="ipsec_alg_first"><select ng-model="ipsec.rule.alg" ng-options="option.value as (option.name | translate) for option in ipsec.getList('alg')" ng-change="ipsec.changeAlg('IKE')"></select></div><div nw-field nw-label="ipsec_hash_mode" ng-if="ipsec.support('ikeHashMode')"><select ng-model="ipsec.rule.ikeHashMode" ng-options="option.value as (option.name | translate) for option in ipsec.getList('ike_hash_mode')"></select></div><div nw-field nw-label="ipsec_hash_size_key" ng-if="ipsec.support('ikeHashSKey')"><select ng-model="ipsec.rule.ikeHashSKey" ng-options="option for option in ipsec.getList('ike_hash_skey')"></select></div><div nw-field nw-label="ipsec_hash"><select ng-model="ipsec.rule.hash" ng-options="option.value as (option.name | translate) for option in ipsec.getList('hash')" ng-change="ipsec.changeHash('IKE')"></select></div><div nw-field nw-label="ipsec_dh_group"><select ng-model="ipsec.rule.dhgroup" ng-options="option.value as (option.name | translate) for option in ipsec.getList('dhgroup')"></select></div><div nw-field nw-label="ipsec_remote_lifetime" nw-required><input nw-number nw-min="0" nw-max="4294967295" ng-model="ipsec.rule.remote_lifetime"></div><div nw-field nw-label="{{ {lang: 'version_of', name: 'IKE', abr: 'name'} | translate }}" ng-if="ipsec.support('version')" nw-disabled="ipsec.rule.nets.length > 1"><select ng-model="ipsec.rule.version" ng-options="option for option in ipsec.getList('version')" ng-change="ipsec.changeVersion()"></select></div></div><div class="col-md-6 block-right"><div class="card-title" ng-bind="'ipsec_second_phase' | translate"></div><div nw-field nw-label="ipsec_mode" ng-if="ipsec.support('modeESP') && ipsec.showMode(ipsec.rule.alg_ph2)"><select ng-model="ipsec.rule.modeESP" ng-options="option.value as (option.name | translate) for option in ipsec.getList('esp_crypto_mode')"></select></div><div nw-field nw-label="ipsec_size_key" ng-if="ipsec.support('sizeKeyESP') && ipsec.showSizeKey(ipsec.rule.alg_ph2)"><select ng-model="ipsec.rule.sizeKeyESP" ng-options="option for option in ipsec.getList('esp_crypto_skey')"></select></div><div nw-field nw-label="ipsec_alg_second"><select ng-model="ipsec.rule.alg_ph2" ng-options="option.value as (option.name | translate) for option in ipsec.getList('alg_ph2')" ng-change="ipsec.changeAlg('ESP')"></select></div><div nw-field nw-label="ipsec_hash_mode" ng-if="ipsec.support('espHashMode')"><select ng-model="ipsec.rule.espHashMode" ng-options="option.value as (option.name | translate) for option in ipsec.getList('esp_hash_mode')"></select></div><div nw-field nw-label="ipsec_hash_size_key" ng-if="ipsec.support('espHashSKey')"><select ng-model="ipsec.rule.espHashSKey" ng-options="option for option in ipsec.getList('esp_hash_skey')"></select></div><div nw-field nw-label="ipsec_hash"><select ng-model="ipsec.rule.auth_alg" ng-options="option.value as (option.name | translate) for option in ipsec.getList('auth_alg')" ng-change="ipsec.changeHash('ESP')"></select></div><div nw-labeled-switch nw-label="ipsec_enable_pfs" nw-model="ipsec.rule.enable_pfs"></div><div nw-field nw-label="ipsec_dh_group_second" nw-disabled="!ipsec.rule.enable_pfs"><select ng-model="ipsec.rule.dhgroup2" ng-options="option.value as (option.name | translate) for option in ipsec.getList('dhgroup2')"></select></div><div nw-field nw-label="ipsec_sainfo_lifetime" nw-required><input nw-number nw-min="0" nw-max="86400" ng-model="ipsec.rule.sainfo_lifetime"></div></div></div><div class="grid-row bottom-space" ng-if="!autoconf.BR2_PACKAGE_ANWEB_DSYSINIT || ipsec.rule.type == 'tunnel'"><div class="table" nw-empty-status="ipsec.rule.nets.length == 0" nw-empty-title="ipsec_tunnels_nets_empty" nw-empty-subtitle="ipsec_tunnels_nets_empty_message" nw-empty-button="act_add" nw-empty-button-click="ipsec.nets.add()" nw-table nw-table-title="ipsec_tunnels_nets_desc" nw-table-on-add="ipsec.nets.add()" nw-table-on-delete="ipsec.nets.remove(items, indexes)" nw-table-on-edit="ipsec.nets.edit(item, index)" nw-table-on-add-disable="ipsec.nets.constraint()" nw-table-selected><table><thead><tr><th ng-bind="'ipsec_source' | translate"></th><th ng-bind="'ipsec_dest' | translate"></th></tr></thead><tbody><tr ng-repeat="item in ipsec.rule.nets" nw-mini-table nw-mini-table-details="ipsec.getMiniTunneledNetworkShort(item)"><td ng-bind="item.source"></td><td ng-bind="item.dest"></td></tr></tbody></table></div></div></div><div class="card-action"><button type="button" ng-if="ipsec.action == 'edit'" ng-click="ipsec.remove()" ng-bind="'act_delete' | translate"></button> <button type="submit" class="colored" ng-disabled="!ipsec.wasModified()" ng-bind="'act_apply' | translate"></button></div></form></div>