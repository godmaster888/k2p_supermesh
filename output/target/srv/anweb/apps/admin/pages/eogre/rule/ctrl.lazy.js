"use strict";!function(){angular.module("app").controllerProvider.register("EoGreRuleCtrl",["$scope","$state","funcs","devinfo","EoGreUtil","translate",function($scope,$state,funcs,devinfo,util){function wasModified(){return __initialRule&&!_.isEqual(__initialRule,angular.copy(eogre.rule))}var __initialRule=null,index=_.isUndefined($state.params.inx)?void 0:parseInt($state.params.inx),currentState=$state.current.name.split(".");currentState.pop(),currentState=currentState.join("."),$scope.eogreRule={isActivate:!1,rule:null,connList:null,lans:null,apply:function(){function success(){$state.go(currentState+".info")}if(!$scope.form.$invalid){var overlay=$scope.overlay.circular,overlayId=overlay.start(),applyObj=util.applyRule(eogre.rule,index);applyObj?util.apply(applyObj).then(success)["catch"](function(){$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})})["finally"](overlay.stop.bind(overlay,overlayId)):success()}},wasModified:wasModified,validation:function(value,type){if(""==value)return null;switch(type){case"PeerIP":if(!funcs.is.ipv4(value))return"msg_invalid_ipv4";if(_.contains(eogre.lans,value))return"apps_partner_ip_is_router_ip";if(!util.checkUnique(value,index,type))return"msg_error_value_is_not_uniq";break;case"Name":if(!util.checkUnique(value,index,type))return"msg_error_value_is_not_uniq";if(value.length>32)return"msg_invalid_name_length"}return null}};var eogre=$scope.eogreRule;!function(){function __activate(){eogre.action=_.isUndefined(index)?"add":"edit",eogre.rule=util.getRule(index),devinfo.once("net").then(function(data){eogre.lans=_.pluck(data.lan,"ip")}),eogre.connList=util.getConnList(),__initialRule=angular.copy(eogre.rule),eogre.isActivate=!0,$scope.$emit("pageload")}function errorPull(){$state.go("error",{code:"msg_error_pull",message:"msg_error_desc"})}util.getActivate()?__activate():util.pull().then(__activate)["catch"](errorPull)}()}])}();