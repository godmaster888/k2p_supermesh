"use strict";!function(){angular.module("app").service("usersUtil",["funcs","device","devinfo","cpe","cpex",function(funcs,device,devinfo,cpe,cpex){function getSettings(){return config?config:{}}var paths={usbUsers:"Device.USB.Users",users:"Device.Users.User."},config=null,converter=device.users.converter,reservedNames=["dmsd","mfc","dsysinit","dwatcher","scheduler","tr","dlinkwatcher","nobody","dsl","ftp"];return{pull:function(){return Promise.all([cpe.GetParameterValues([paths.usbUsers,paths.users]),cpe.GetParameterAttributes([paths.usbUsers])]).then(function(response){var data=funcs.buildTree(response[0].result.ParameterList);return config=converter.dsysinitToNative(data),Promise.resolve()})},apply:function(settings){var data=converter.nativeToDsysinit(settings.user);return cpe.ApplyDifference(data)},getSettings:getSettings,remove:function(items){return cpex.remove(_.pluck(items,"__id"),"Device.USB.Users.")},getInvalidLogins:function(cb,$scope){devinfo.subscribe(paths.users,function(data){var users;data&&data[paths.users]&&(users=converter.dsysinitToNative(data[paths.users]),cb&&cb(_.union(reservedNames,users.invalidUsernames)))},$scope)}}}])}();