"use strict";!function(){function StorageDlnaController($scope,util,funcs,snackbars,ngDialog,translate){function init(){util.pull().then(function(){$scope.dlna=util.getSettings(),$scope.$emit("pageload")})}function getMediaTypesList(){var mediaType=[{value:"ALL",label:"dlna_media_type_all"},{value:"A",label:"dlna_media_type_audio"},{value:"V",label:"dlna_media_type_video"},{value:"P",label:"dlna_media_type_pictures"}];return $scope.dlna?_.filter(mediaType,function(e){return _.contains($scope.dlna.MediaTypes,e.value)}):mediaType}function editDir(dir,isNew){var dlg=ngDialog.open({template:"dialogs/dlna/dialog.tpl.html",controller:"MediaDirDialogController",className:"dlna-dialog dialog_fixed_footer",resolve:funcs.getLazyResolve("dialogs/dlna/ctrl.lazy.js","MediaDirDialogController"),data:{dir:angular.copy(dir),mediaTypes:getMediaTypesList(),isNew:isNew}});dlg.closePromise.then(function(result){result&&result.value&&!_.isString(result.value)&&(isNew?$scope.dlna.MediaDirs.push(result.value):_.extend(dir,result.value))})}init(),$scope.saveEnabled=function(){return util.isChange($scope.dlna)&&(!$scope.dlna.Enable||$scope.dlna.Enable&&$scope.dlna.MediaDirs.length>0)},$scope.isChange=function(){return util.isChange($scope.dlna)},$scope.getMediaTypeInfo=function(mediaType){switch(mediaType){case"ALL":return translate("dlna_media_type_all");case"A":return translate("dlna_media_type_audio");case"V":return translate("dlna_media_type_video");case"P":return translate("dlna_media_type_pictures")}},_.extend($scope,{apply:function(){function error(error){$scope.dlna.Enable?error&&"invalid_usb_path"==error.name?($scope.dlna.InvalidPath=!0,alert(translate("dlna_invalid_usb_path_note")),snackbars.add("dlna_invalid_usb_path_note")):snackbars.add("msg_rpc_write_error"):snackbars.add("msg_rpc_write_success"),init()}if(!$scope.dlna_form.$invalid){var overlay=$scope.overlay.circular,overlayId=overlay.start();util.apply($scope.dlna).then(function(){$scope.dlna.InvalidPath=!1,snackbars.add("msg_rpc_write_success"),init()})["catch"](error)["finally"](overlay.stop.bind(overlay,overlayId))}},editDir:editDir,createDir:function(){editDir({Type:"ALL"},!0)},removeDir:function(dir,indexes){$scope.dlna.MediaDirs=_.toArray(_.omit($scope.dlna.MediaDirs,indexes))},mediaTypes:getMediaTypesList()})}angular.module("app").controllerProvider.register("storageDlnaController",StorageDlnaController),StorageDlnaController.$inject=["$scope","dlnaUtil","funcs","snackbars","ngDialog","translate"]}();