"use strict";angular.module("app").controllerProvider.register("clientSessionsStatsCtrl",["$scope","devinfo","funcs","ngDialog","$state","statsClientsUtil","ipv6cut",function($scope,devinfo,funcs,ngDialog,$state,util,ipv6cut){function getRowsForCollapsedTable(rows,param){var newRowsArr=[],uniqParams=function(rows,param){var params=[];return _.each(rows,function(row){row[param]&&params.push(row[param])}),_.uniq(params)}(rows,param);return _.each(uniqParams,function(mac){var backupElem,elemProperties,listMac=_.filter(rows,function(elem){return elem.mac==mac});listMac&&listMac.length>1?(backupElem=_.find($scope.clientStatsBackup,function(elem){return elem.mac==mac&&void 0!=elem.arrow}),elemProperties=_.find(rows,function(elem){return elem.mac==mac&&funcs.is.ipv4(elem.ip)}),newRowsArr.push({mac:mac,ip:elemProperties?elemProperties.ip:"",hostname:elemProperties?elemProperties.hostname:"",flags:elemProperties?elemProperties.flags:"",name:elemProperties?elemProperties.name:"",arrow:!0,showParams:!0,stateArrow:backupElem&&backupElem.stateArrow?backupElem.stateArrow:"close"}),_.each(listMac,function(elem,inx){elem.arrow||(listMac[inx].hidden=backupElem&&backupElem.stateArrow&&"open"==backupElem.stateArrow?!1:!0)})):listMac[0].alwaysShow=!0,newRowsArr=_.union(newRowsArr,listMac)}),newRowsArr}$scope.clientStatsBackup=[],$scope.isActivate=!1,util.subscribeInfo(function(data){$scope.clientStats=data,$scope.clientStats=getRowsForCollapsedTable($scope.clientStats,"mac"),$scope.isActivate||($scope.clientStatsBackup=angular.copy($scope.clientStats),$scope.isActivate=!0),$scope.$emit("pageload")},$scope),$scope.showDetails=function(item){$state.go("stats.clientsSessionsInfo",{ifaceName:item.name.toLowerCase(),ip:item.ip})},$scope.getArrowClass=function(item){return item.stateArrow?item.stateArrow:"hidden"},$scope.getClickAction=function(item,index){item.arrow?("close"==item.stateArrow?($scope.clientStats[index].stateArrow="open",_.each($scope.clientStats,function(elem,inx){elem.arrow||elem.mac!=item.mac||($scope.clientStats[inx].hidden=void 0)})):"open"==item.stateArrow&&($scope.clientStats[index].stateArrow="close",_.each($scope.clientStats,function(elem,inx){elem.arrow||elem.mac!=item.mac||($scope.clientStats[inx].hidden=!0)})),$scope.clientStatsBackup=$scope.clientStats):$scope.showDetails(item)},$scope.getStyleVal=function(index){return"open"==$scope.clientStats[index].stateArrow?"hidden":"visible"},$scope.getCaptionPrefixClass=function(item){return item.arrow?"collapsed_arrow "+$scope.getRowIcon(item):void 0},$scope.getCaption=function(item){return item.arrow?item.mac:item.alwaysShow?item.mac:ipv6cut(item.ip)},$scope.getShortInfo=function(item){var result=[];return item.arrow||(item.alwaysShow&&result.push(ipv6cut(item.ip)),item.hostname&&result.push(item.hostname),item.flags&&result.push(item.flags),item.name&&result.push(item.name)),result},$scope.getRowIcon=function(item){return item.arrow?"open"==item.stateArrow?"open":"close":"hidden"}}]);