"use strict";!function(){angular.module("app").service("PortSettingsUtil",["$rootScope","cpe","device","devinfo","funcs",function($rootScope,cpe,device,devinfo,funcs){function makeHelper(){return new device.portSettings.Helper(config)}function getSpeedList(){var result=[];return result.push("auto"),attrs.speedList&&(result=result.concat(attrs.speedList)),result}var config=null,attrs=null,converter=device.portSettings.converter,constants={"switch":"Device.Switch.",stats:"Device.Statistics.Port."};return{preload:function(){return $rootScope.portsDefer.promise.then(function(data){config={preload:!0,ports:_.map(data,function(name){return{name:name}})}})},pull:function(){function success(response){return config=funcs.buildTree(response[0].result.ParameterList),attrs=converter.attrs(funcs.buildTreeAttributes(response[1].result.ParameterList)),funcs.deepClone(config),config=converter.cpeToNative(config),Promise.resolve()}function error(response){var error=response&&response.error?response.error:{};return Promise.reject(error)}return Promise.all([cpe.GetParameterValues([constants["switch"],constants.stats]),cpe.GetParameterAttributes([constants["switch"]])]).then(success,error)},apply:function(input){var data=converter.nativeToCpe(input);return _.isEmpty(data)?Promise.resolve():cpe.ApplyDifference(data)},subscribe:function(cb,$scope){devinfo.subscribe(constants["switch"]+"|"+constants.stats,function(response){if(response&&response[constants["switch"]]){var sw=funcs.splitTree(response[constants["switch"]]),stats=funcs.splitTree(response[constants.stats]),input=funcs.buildTree(sw.concat(stats)),ports=converter.cpeToNative(input),helper=new device.portSettings.Helper(ports);ports=helper.getData(),cb&&cb(ports)}},$scope)},makeHelper:makeHelper,getSpeedList:getSpeedList}}])}();