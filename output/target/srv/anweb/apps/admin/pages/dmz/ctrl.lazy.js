"use strict";!function(){angular.module("app").controllerProvider.register("DmzCtrl",["$scope","$state","dmzUtil","funcs","devinfo",function($scope,$state,util,funcs,devinfo){function activate(){function stopOverlay(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null)}util.pull().then(function(){dmz.data=util.getConfig(),__backupRule=funcs.deepClone(dmz.data),dmz.isActivate=!0,$scope.$emit("pageload")})["catch"](function(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})})["finally"](stopOverlay),devinfo.once("net").then(function(data){$scope.dmz.lans=data.lan})}function showIpWarning(){if($scope.dmz.data&&$scope.dmz.data.dmz&&$scope.dmz.data.dmz.enable&&funcs.is.ipv4($scope.dmz.data.dmz.ip)){if(!isLanIp($scope.dmz.data.dmz.ip,$scope.dmz.lans))return!0;if(util.disableUseLanIp()&&isRouterIp($scope.dmz.data.dmz.ip,$scope.dmz.lans))return!0}return!1}function isLanIp(ip,lans){if(_.isUndefined(lans))return!0;var lanCheckers=_.map(lans,function(lan){if(lan.ip&&lan.mask){var range=funcs.ipv4.subnet.getNetworkRange(lan.ip,lan.mask);return function(addr){return funcs.ipv4.subnet.belongNetworkRange(range,addr)}}});return _.some(lanCheckers,function(checkLan){return _.isUndefined(checkLan)?!0:checkLan(ip)})}function isRouterIp(ip,lans){return _.isUndefined(lans)?!1:_.some(lans,function(lan){return ip==lan.ip})}function apply(){function error(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null),$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})}$scope.form.$invalid&&dmz.data.dmz.enable||(overlayId=$scope.overlay.circular.start(),dmz.data.dmz.enable||(dmz.data.dmz=_.extend(dmz.data.dmz,__backupRule.dmz),dmz.data.dmz.enable=!1),util.apply(dmz.data).then(activate)["catch"](error))}function wasModified(){return __backupRule&&!_.isEqual(__backupRule,dmz.data)}$scope.dmz={isActivate:!1,data:null,apply:apply,useEnableSNAT:function(){return util.useEnableSNAT()},wasModified:wasModified,needDisableApply:function(){return!wasModified()||autoconf.BR2_PACKAGE_ANWEB_CUSTOM_PARTNER_23078&&showIpWarning()},showIpWarning:showIpWarning,getIpWarning:function(){return isLanIp($scope.dmz.data.dmz.ip,$scope.dmz.lans)?isRouterIp($scope.dmz.data.dmz.ip,$scope.dmz.lans)?"apps_partner_ip_is_router_ip":void 0:"dmz_ip_warning"}};var dmz=$scope.dmz,__backupRule=null,overlayId=null;activate()}])}();