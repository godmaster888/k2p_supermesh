"use strict";angular.module("app").controller("WanInfoCtrl",["$scope","$state","devinfo","wanPage","wanPageCommon","anwebStorage",function($scope,$state,devinfo,wanPage,wanPageCommon,anwebStorage){function onUpdate(data){$scope.data=data,$scope.haveConns=data.__flatConnList.length;var storage=$scope.modeStorage,simpleModeAvail=isSimpleConfig(data);$scope.haveConns&&(storage&&storage.get("advanced")||!simpleModeAvail?$state.go(baseStateName+".advanced",{simpleModeAvail:simpleModeAvail,data:data}).then(function(){}):$state.go(baseStateName+".simple",{data:data}).then(function(){}))}function onError(error){console.log("onErrorrr!"),console.log(error)}function isSimpleConfig(data){var list=data.__flatConnList;return 1==list.length?!0:2!=list.length?!1:wanPage.isSimpleConfig(list)}var baseStateName=$state.current.name;devinfo.once("version").then(function(res){return $scope.modeStorage=anwebStorage.make("wanMode-"+res.modelId+"-"+res.buildDate),wanPage.pull()}).then(function(data){$scope.data=data,onUpdate(data),$scope.$emit("pageload"),wanPage.subscribe(onUpdate,$scope)})["catch"](onError),$scope.$on("switchWanPageMode",function(event,advanced){var storage=$scope.modeStorage;storage&&storage.set("advanced",advanced),onUpdate($scope.data)}),$scope.$on("pageNeedUpdate",function(){var overlay=$scope.overlay.circular.start();wanPage.pull().then(function(data){$scope.overlay.circular.stop(overlay),onUpdate(data),$scope.$emit("pageload")})["catch"](onError)}),$scope.$on("goToEditing",function($event,path){var editingStateName=wanPageCommon.getSiblingStateFullName(baseStateName,"edit");$state.go(editingStateName,{path:path})}),$scope.$on("goToAdding",function($event,simple){var addingStateName=wanPageCommon.getSiblingStateFullName(baseStateName,"add");$state.go(addingStateName,{simple:simple})})}]);