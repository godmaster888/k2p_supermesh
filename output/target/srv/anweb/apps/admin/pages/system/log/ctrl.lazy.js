"use strict";!function(){angular.module("app").controllerProvider.register("SysLogCtrl",["$scope","$state","$timeout","sysLogUtil","ngDialog","funcs","translate","snackbars",function($scope,$state,$timeout,util,ngDialog,funcs,translate,snackbars){function init(){initSettings()}function initSettings(){function error(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}util.pullSettings().then(function(){syslog.settings=util.getSettings(),syslog.usbSupportedClass="bottom-space",function(){util.updateUsbStorage(function(input){syslog.usbStorage=input,syslog.isNeedPull=numberOfStorage()?syslog.isNeedPull:!0,syslog.isNeedPull&&numberOfStorage()&&initSettings()},$scope)}();var syslogTab=$state.params.tab?$state.params.tab:_.first(syslog.tabs.list).state;syslog.tabs.state=syslogTab,"log"==syslogTab&&syslog.updateLog(),syslog.settings.Log2USB&&(""==syslog.settings.Log2USB.Directory&&(syslog.settings.Log2USB.Directory="/usb1_1"),""==syslog.settings.Log2USB.File&&(syslog.settings.Log2USB.File="log")),__backup=funcs.deepClone(syslog.settings),syslog.isActivate=!0,syslog.isNeedPull=!1})["catch"](error)["finally"]($scope.$emit.bind($scope,"pageload"))}function numberOfStorage(){return syslog.usbStorage?_.size(syslog.usbStorage):0}function wasModified(){return syslog.isActivate?__backup&&!funcs.deepEqual(__backup,syslog.settings):!1}$scope.syslog={isActivate:!1,isNeedPull:!0,log:null,settings:null,usbStorage:null,logLoading:!1,tabs:{list:[{name:"syslog_log",state:"log"},{name:"syslog_settings",state:"settings"}],state:null,change:function(state){syslog.tabs.state=state,"log"==state&&syslog.updateLog(),$state.go(".",{tab:state},{notify:!1})}},apply:function(){function error(error){error&&"invalid_usb_path"==error.name?(syslog.settings.Log2USB.InvalidPath=!0,alert(translate("syslog_invalid_usb_path_win")),snackbars.add("syslog_invalid_usb_path_win"),init()):$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})}if(!$scope.form.$invalid&&wasModified()){var overlay=$scope.overlay.circular,overlayId=overlay.start();util.apply(syslog.settings).then(function(){syslog.settings.Log2USB&&(syslog.settings.Log2USB.InvalidPath=!1),snackbars.add("msg_apply_success"),init()})["catch"](error)["finally"](overlay.stop.bind(overlay,overlayId))}},updateLog:function(){syslog.logLoading=!0,util.updateLog().then(function(list){syslog.log=list,$timeout(function(){var log=document.getElementById("log");log.scrollTop=log.scrollHeight})})["finally"](function(){return syslog.logLoading=!1})},unmountUsb:function(id){var overlay=$scope.overlay.circular,overlayId=overlay.start();util.unmountUsb(id).then(snackbars.add.bind(snackbars,"syslog_unmount_success"))["catch"](snackbars.add.bind(snackbars,"syslog_unmount_error_desc"))["finally"](overlay.stop.bind(overlay,overlayId))},isRemoteConfig:function(){return syslog.settings&&syslog.settings.Enable&&("Remote"==syslog.settings.Destination||"Both"==syslog.settings.Destination)},getDestinationList:function(){return _.filter([{name:"syslog_local",value:"Local"},{name:"syslog_remote",value:"Remote"},{name:"syslog_both",value:"Both"}],function(e){return _.contains(util.getDestinationList(),e.value)})},getDestinationInfo:function(destination){switch(destination){case"Local":return"syslog_local_info";case"Remote":return"syslog_remote_info";case"Both":return"syslog_both_info"}},getLevels:function(){return _.filter([{name:"syslog_shared_not_efficient",value:0},{name:"syslog_shared_alert_messages",value:1},{name:"syslog_shared_critical_events",value:2},{name:"syslog_shared_error_messages",value:3},{name:"syslog_shared_different_warnings",value:4},{name:"syslog_shared_important_notifications",value:5},{name:"syslog_shared_info_messages",value:6},{name:"syslog_shared_debugging_messages",value:7}],function(e){return _.contains(util.getLevels(),e.value)})},numberOfStorage:numberOfStorage,openFileBrowser:function(path){numberOfStorage()&&ngDialog.open({template:"dialogs/filebrowser/dialog.tpl.html",controller:"DialogFileBrowserCtrl",resolve:funcs.getLazyResolve("dialogs/filebrowser/ctrl.lazy.js","DialogFileBrowserCtrl"),data:{title:"",path:path},scope:$scope}).closePromise.then(function(data){data.value&&syslog.settings.Log2USB&&(syslog.settings.Log2USB.Directory=data.value)})},wasModified:wasModified,checkRotateSize:function(){0==syslog.settings.Log2USB.RotateSize&&(syslog.settings.Log2USB.RotateNumber=1)},needExt:util.needExt};var syslog=$scope.syslog,__backup=null;init()}])}();