"use strict";!function(){angular.module("app").controllerProvider.register("wifiAdvCtrl",["$scope","$state","translate","wifiAdvancedConstants",function($scope,$state,translate,constants){function getKeyByValue(object,value){return _.find(_.keys(object),function(key){return object[key]==value})}function changeBand(freq){isFormInvalid()||($scope.wifi.band.state=freq,device.wifi.setBandFreq(freq),$scope.wifi.radio=device.wifi.getBand(0).radio,load(freq),$state.go(".",{freq:freq},{notify:!1}),$scope.currentChannelBandwidth=allBandwidths[$scope.wifi.radio.CurrentChannelBandwidth],$scope.wifi.tmpBandwidth=$scope.wifi.radio.OperatingChannelBandwidth?allBandwidths[$scope.wifi.radio.OperatingChannelBandwidth]:null)}function load(freq){var nowHref=location.href.split("#")[1],freqArr=nowHref.split("=");freqArr[1]=freq;var newHref=freqArr.join("=");location.href="#"+newHref}function isFormInvalid(){return $scope.form.$invalid}var device=$scope.device;$scope.wifi={isActivate:!1,tmpBandwidth:null,radio:null,apply:function(){function errorCb(){$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})}if(!isFormInvalid()){var overlayId=overlay.start();device.wifi.push(function(error){overlay.stop(overlayId),error?errorCb():$state.go($state.current,{},{reload:!0})})["catch"](function(){overlay.stop(overlayId),device.wifi.isWirelessClient()||errorCb()})}},wasModified:function(){return $scope.wifi.isActivate&&device.wifi.isChange()},supportedParam:function(param){return"TxPreamble"==param?$scope.wifi.constants.TxPreamble.supported:"5GHz"==$scope.wifi.band.state&&"BGProtection"==param?!1:"TxBeamforming"==param?$scope.wifi.radio.TxBeamforminAvailable:"DFS"==param?$scope.wifi.radio.DFSAvailable:"STBC"==param?$scope.wifi.radio.STBCAvailable:device.wifi.supportedParam(param)},getChannelBandwidthList:function(){var shownBandwidths=[],tmpSupportedBandwidth=$scope.wifi.radio?$scope.wifi.radio.SupportedChannelBandwidth.split(","):[];return _.each(tmpSupportedBandwidth,function(bandwidth){shownBandwidths.push(allBandwidths[bandwidth])}),shownBandwidths},getTransmitPowerList:function(){return $scope.wifi.radio?$scope.wifi.radio.TransmitPowerSupported.split(","):[]},getBGProtectionList:function(){return $scope.wifi.constants.BGProtection.list},getTxPreambleList:function(){return $scope.wifi.constants.TxPreamble.list},getAutoChannelType:function(){return _.map($scope.wifi.radio.AutoChannelTypeSupported,function(type){return{value:type,name:"wifi_advanced_auto_channel_type_"+type.toLowerCase()}})},getHTGIList:function(){return $scope.wifi.constants.HTGI.list},getExtChannelList:function(){var list=angular.copy($scope.wifi.constants.ExtensionChannel.list),channel=angular.copy($scope.wifi.radio.Channel),channelList=angular.copy($scope.wifi.radio.PossibleChannels);return _.last(channelList)-4<channel&&(list=_.filter(list,function(e){return"wifi_advanced_above_channel"!=e.name})),_.first(channelList)+4>channel&&(list=_.filter(list,function(e){return"wifi_advanced_below_channel"!=e.name})),list},showExtChannel:function(bandwidth){return!$scope.wifi.radio.AutoChannelEnable&&"20/40MHz"==bandwidth},showCoexistence:function(bandwidth){return"20/40MHz"==bandwidth||"20/40/80MHz"==bandwidth||"Auto"==bandwidth&&autoconf.BR2_PACKAGE_ANWEB_DSYSINIT},getBandwidthDetailKey:function(key){var langKey="wifi_"+key.replace(/([0-9])(mhz)/g,"$1").replace(/([0-9])([a-z])/g,"$1_$2");return translate(langKey)}},$scope.wifi.band={list:[],state:null,change:changeBand,load:load,translateBand:function(key){return translate("2.4GHz"==key?"24ghz":"5ghz")}};var allBandwidths={},overlay=$scope.overlay.circular;!function(){device.wifi.pullAdv(function(){device.wifi.hasBand("2.4GHz")&&$scope.wifi.band.list.push("2.4GHz"),device.wifi.hasBand("5GHz")&&$scope.wifi.band.list.push("5GHz"),allBandwidths={"20MHz":translate("wifi_bandwidth_20"),"20/40MHz":"20/"+translate("wifi_bandwidth_40"),"20/40/80MHz":"20/40/"+translate("wifi_bandwidth_80"),"20/40/80/160MHz":"20/40/80/"+translate("wifi_bandwidth_160"),"40MHz":translate("wifi_bandwidth_40"),"80MHz":translate("wifi_bandwidth_80"),"160MHz":translate("wifi_bandwidth_160"),Auto:"Auto"};var freq=$state.params.freq?$state.params.freq:_.first($scope.wifi.band.list);$scope.wifi.band.state=freq,device.wifi.setBandFreq(freq),$scope.wifi.radio=device.wifi.getBand(0).radio,$scope.wifi.constants=constants(),$scope.wifi.tmpBandwidth=$scope.wifi.radio.OperatingChannelBandwidth?allBandwidths[$scope.wifi.radio.OperatingChannelBandwidth]:null,$scope.currentChannelBandwidth=allBandwidths[$scope.wifi.radio.CurrentChannelBandwidth],$scope.wifi.isActivate=!0,$scope.$emit("pageload")})}(),$scope.$watch("wifi.tmpBandwidth",function(value){var bandwidth=getKeyByValue(allBandwidths,value);_.isUndefined(bandwidth)||($scope.wifi.radio.OperatingChannelBandwidth=bandwidth)},!0)}])}();