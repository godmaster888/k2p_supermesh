"use strict";!function(){angular.module("app").controller("WifiAPSettings",["$scope","$state","device","cookie","history","translate",function($scope,$state,device,cookie,history,translate){function supportedModes(){if(!$scope.wifi.ap.data)return[];var operatingStands=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.OperatingStandards?$scope.wifi.general.data.OperatingStandards:standards,modeAvailable=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.ModeAvailable?$scope.wifi.general.data.ModeAvailable:availableModes,modesTemplate=helper.getTempModes(modeAvailable,operatingStands);$scope.wifi.ap.pmfList=helper.getPMFList(operatingStands,$scope.wifi.ap.data.Security.ModeEnabled,modeAvailable);var modesSupported=$scope.wifi.ap.data.Security.ModesSupported.split(","),modes=_.filter(modesTemplate,function(obj){return~_.indexOf(modesSupported,obj.value)});return $scope.customRules.ExcludeWifiSecurityMode&&(modes=_.filter(modes,function(item){return!_.some($scope.customRules.ExcludeWifiSecurityMode,function(exclude){return exclude==item.value})})),_.findWhere(modes,{value:$scope.wifi.ap.data.Security.ModeEnabled})||($scope.wifi.ap.data.Security.ModeEnabled=modes[0].value),_.each(modes,function(item,index){/mixed/.test(item.name)&&(modes[index].name=item.name.replace("mixed",translate("wifi_mixed")))}),modes}function showSecurity(type){var operatingStands=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.OperatingStandards?$scope.wifi.general.data.OperatingStandards:standards,modeAvailable=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.ModeAvailable?$scope.wifi.general.data.ModeAvailable:availableModes;return helper.checkSecurityType(type,$scope.wifi.ap.data,operatingStands,modeAvailable)}function isOpen(){var operatingStands=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.OperatingStandards?$scope.wifi.general.data.OperatingStandards:standards,modeAvailable=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.ModeAvailable?$scope.wifi.general.data.ModeAvailable:availableModes;return helper.isOpen($scope.wifi.ap.data,operatingStands,modeAvailable)}function getEncrypTypes(){var operatingStands=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.OperatingStandards?$scope.wifi.general.data.OperatingStandards:standards,modeAvailable=$scope.wifi.general&&$scope.wifi.general.data&&$scope.wifi.general.data.ModeAvailable?$scope.wifi.general.data.ModeAvailable:availableModes;return helper.getEncrypTypes($scope.wifi.ap.data,operatingStands,modeAvailable)}function changeBandwidthRestricted(value){!$scope.wifi.ap.data||_.isNull(value)||_.isUndefined(value)||(value?$scope.BandwidthRestrictedBackup&&($scope.wifi.ap.data.BandwidthRestricted=angular.copy($scope.BandwidthRestrictedBackup),$scope.BandwidthRestrictedBackup=null):($scope.BandwidthRestrictedBackup=angular.copy($scope.wifi.ap.data.BandwidthRestricted),$scope.wifi.ap.data.BandwidthRestricted=0))}function isEdit(){return"edit"===action}function isAdd(){return"add"===action}function isChange(){return _.size(device.funcs.getChanges($scope.wifi.ap.data,backupData))}function initNSG(){_.isUndefined(backupData.NSG)&&(backupData.NSG=$scope.wifi.ap.data.NSG=!1)}var helper=device.wifi.helper,action=$state.current.name.split(".").pop(),freq=$state.params.freq,isAPMode="ap"===cookie.get("device_mode"),standards=null,backupData=null,availableModes=null;$scope.wifi.ap={data:null,pmfList:null,supportedParam:function(param,subPath){var band=device.wifi.getBand(0),root=subPath?subPath+".":"";return band.ap.supportedParam(param,root)},supportedModes:supportedModes,showSecurity:showSecurity,showPreAuth:function(mode){return"WPA2-Enterprise"==mode||"WPA-WPA2-Enterprise"==mode},getEncrypTypes:getEncrypTypes,getDefaultKeysID:function(){return helper.getDefaultKeysID()},getPMFList:function(){var supportedFrames=[];return _.each([{name:"wifi_protected_frames_without",value:"NoMgmtFrameProtection"},{name:"wifi_protected_frames_optional",value:"MgmtFrameProtectionOptional"},{name:"wifi_protected_frames_required",value:"MgmtFrameProtectionRequired"}],function(elem){-1!=_.indexOf($scope.wifi.ap.pmfList,elem.value)&&supportedFrames.push(elem)}),supportedFrames},validWEPKey:function(wepKey){return $scope.wifi.ap.data?helper.validWEPKey(wepKey,$scope.wifi.ap.data):null},validPSKKey:function(pskKey){var messErr=helper.validPSKKey(pskKey);return messErr},validRadiusSecret:function(secret){return autoconf.BR2_PACKAGE_ANWEB_DSYSINIT?helper.validRadiusParamLen(secret):null},getWEPKeyLenMessage:function(){return $scope.wifi.ap.data?helper.getWEPKeyLenMessage($scope.wifi.ap.data):null},isOpen:isOpen,isEdit:isEdit,isAdd:isAdd,isChange:isChange,isShowGuestAccess:function(){return(isAdd()||$state.params.inx>1)&&!isAPMode},initNSG:initNSG,changeBandwidthRestricted:changeBandwidthRestricted,generatePreSharedKey:function(){var i,position,result="",words="0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM",maxPosition=words.length-1;for(i=0;10>i;++i)position=Math.floor(Math.random()*maxPosition),result+=words.substring(position,position+1);$scope.wifi.ap.data.Security.PreSharedKey=result},isDisabledPMF:function(){return"WPA3"==$scope.wifi.ap.data.Security.ModeEnabled||"WPA2-WPA3"==$scope.wifi.ap.data.Security.ModeEnabled},setPMF:function(){if($scope.wifi.ap.supportedParam("ProtectedManagementFrames","Security")){var mode=$scope.wifi.ap.data.Security.ModeEnabled;$scope.wifi.ap.data.Security.ProtectedManagementFrames="WPA3"==mode?"MgmtFrameProtectionRequired":"WPA2-WPA3"==mode?"MgmtFrameProtectionOptional":"NoMgmtFrameProtection"}}},$scope.schedule={active:!1},$scope.BandwidthRestricted={enable:null,min:"1",max:"2.4GHz"==freq?"150":"450"},$scope.$watch(getEncrypTypes,function(types){if(types&&types.length&&$scope.wifi.ap.data){var encr=$scope.wifi.ap.data.Security.EncryptionType;_.contains(types,encr)||($scope.wifi.ap.data.Security.EncryptionType=types[0])}},!0),$scope.$watch("wifi.advancedAp.bandwidthRestrictedEnable",changeBandwidthRestricted),function(){var inxSsid,band=device.wifi.getBand(0),ap=band.ap;standards=band.radio.OperatingStandards,availableModes=band.radio.ModeAvailable,isEdit()?(history.setCleanLastHistory(!0),inxSsid=$state.params.inx,$scope.wifi.ap.data=ap.get(inxSsid)):isAdd()?(history.setCleanLastHistory(!0),inxSsid=ap.add(ap.getDefault()),$scope.wifi.ap.data=ap.get(inxSsid)):$scope.wifi.ap.data=ap.getBase(),$scope.wifi.ap.inxRadio=band.radio.Inx,$scope.wifi.ap.inxSsid=_.isUndefined(inxSsid)?"1":inxSsid,$scope.BandwidthRestricted.enable=0!=$scope.wifi.ap.data.BandwidthRestricted,backupData=angular.copy($scope.wifi.ap.data)}()}])}();