"use strict";!function(){angular.module("app").controllerProvider.register("wifiSupermeshCtrl",["$scope","$state","device","funcs","wifiSuperMeshUtil","devinfo","ngDialog","translate",function($scope,$state,device,funcs,util,devinfo,ngDialog,translate){function activate(overlayId){util.pull().then(function(){$scope.band.list.length=0,$scope.band.list=util.getBands();var freq=$state.params.freq?$state.params.freq:_.first($scope.band.list);$scope.band.state=freq,util.setFreq(freq),$scope.supermesh.data=util.getData(freq),__backupData=angular.copy($scope.supermesh.data),$scope.supermesh.isActivate=!0,util.subscribeInfo(statsInfo,$scope),$scope.$emit("pageload")})["catch"](function(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})})["finally"](function(){overlayId&&overlay.stop(overlayId)})}function statsInfo(data){$scope.supermesh.data.StatisticNet=data.StatisticNet,$scope.supermesh.data.StatisticAP=data.StatisticAP,$scope.supermesh.data.StatisticClients=data.StatisticClients,$scope.supermesh.data.StatisticNeighbours=data.StatisticNeighbours}function apply(){function applySettings(){var overlayId=overlay.start();util.push($scope.supermesh.data).then(function(){activate(overlayId)})["catch"](function(){overlay.stop(overlayId),$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})})}function showDialog(){return ngDialog.open({template:"/admin/dialogs/wifi_enable_autochannel/dialog.tpl.html",controller:"WiFiAutochannelCtrl",scope:$scope})}$scope.form.$invalid||(!__backupData.Enable||$scope.supermesh.data.Enable||$scope.supermesh.data.PreferMaster?applySettings():showDialog().closePromise.then(function(result){result&&result.value&&"enable"==result.value.action&&($scope.supermesh.data.AutoChannelEnable=!0),applySettings()}))}function wasModified(){return __backupData&&_.some(__backupData,function(item,key){return~key.indexOf("Statistic")?!1:!_.isEqual(item,$scope.supermesh.data[key])})}function getShortClient(item){return[{title:translate("state"),info:item.State}]}function getShortNeighbour(item){return[{title:translate("neighbourType"),info:item.NeighbourType},{title:translate("hops"),info:item.Hops}]}function getShortNet(item){return[{title:translate("mac"),info:item.MAC},{title:translate("meshRole"),info:item.MeshRole}]}function loadBand(freq){location.href="#wifi/supermesh?freq="+freq}var __backupData=null;$scope.supermesh={data:null,isActivate:!1,apply:apply,wasModified:wasModified,multiRadio:function(){return $scope.supermesh.data.RadioBands.length>1},checkDomain:function(value){return value.length>31?"msg_input_lenght_more_max":null},supportedModes:function(){var radio=util.getRadioBands($scope.band.state),standart=radio.Standart;_.find($scope.supermesh.data.ModeAvailable,function(e){return e.Standard==standart});var supportModes=[{name:"WPA2-PSK",value:"WPA2-Personal"}];return _.findWhere(supportModes,{value:$scope.supermesh.data.Security.ModeEnabled})||($scope.supermesh.data.Security.ModeEnabled=supportModes[0].value),supportModes},getEncrypTypes:function(){var radio=util.getRadioBands($scope.band.state),standart=radio.Standart,modeAvailable=_.find($scope.supermesh.data.ModeAvailable,function(e){return e.Standard==standart}),encrTypes=helper.getEncrypTypes($scope.supermesh.data,standart,[modeAvailable]);return _.contains(encrTypes,$scope.supermesh.data.Security.EncryptionType)||($scope.supermesh.data.Security.EncryptionType=encrTypes[0]),encrTypes},showSecurity:function(type){var radio=util.getRadioBands($scope.band.state),standart=radio.Standart,modes=_.find($scope.supermesh.data.ModeAvailable,function(e){return e.Standard==standart});return helper.checkSecurityType(type,$scope.supermesh.data,standart,[modes])},supportedParam:function(param,subPath){return util.supportedParam(param,subPath)},getShortTitle:function(item){switch($scope.supermesh.data.StatisticView){case"apList":case"netReview":return item.ModelName;case"clientList":return item.ApMAC+"-"+item.MAC;case"neighbours":return item.MAC+"-"+item.NeighbourMAC}},getShort:function(item){switch($scope.supermesh.data.StatisticView){case"apList":case"netReview":return getShortNet(item);case"clientList":return getShortClient(item);case"neighbours":return getShortNeighbour(item)}},showDetails:function(item){devinfo.suspend();var dlg=ngDialog.open({template:"/admin/dialogs/wifi_supermesh_stats/dialog.tpl.html",controller:"wifiSupermeshStatCtrl",className:"wifi_supermesh_dialog nw-static-mobile-collapse",resolve:funcs.getLazyResolve("/admin/dialogs/wifi_supermesh_stats/ctrl.lazy.js","wifiSupermeshStatCtrl"),data:{header:item.Name||item.Domain,data:item}});dlg.closePromise.then(function(){devinfo.resume()})},needShow:function(){return"AccessPoint"==$scope.supermesh.data.DeviceMode},notEnable:function(){return util.notEnable($scope.band.state)},getEnabledNote:function(param){var href,band="2.4GHz"==$scope.band.state?"5ghz":"24ghz";return"Mesh"==param?translate("5ghz"==band?"wifi_supermesh_not_enabled_note?name=5ghz":"wifi_supermesh_not_enabled_note?name=24ghz"):"Client"==param?(href='<a href="#/wifi/client?freq='+$scope.band.state+'">'+translate("wifi_client_mode")+"</a>",translate("wifi_client_mesh_note?name=wifi_mesh_function&abr=name",{mode:href})):void 0}},$scope.band={list:[],state:null,change:function(freq){$scope.band.state=freq,util.setFreq(freq),$scope.supermesh.data=util.getData(freq),__backupData=angular.copy($scope.supermesh.data),loadBand(freq),$state.go(".",{freq:freq},{notify:!1})},load:loadBand,translateBand:function(freq){return translate("2.4GHz"==freq?"24ghz":"5ghz")}};var helper=funcs.wifiHelper,overlay=$scope.overlay.circular;activate()}])}();