"use strict";!function(){angular.module("app").controller("wifiWPSSettings",["$scope","$state","device","wifiWpsUtil","ngDialog","funcs","wifiWpsShared","snackbars",function($scope,$state,device,util,ngDialog,funcs,shared,snackbars){function activate(){var band=device.wifi.getBand(0);$scope.wifi.wps.connectMethod=band.wps.getConnectMethod(inx),$scope.wifi.wps.info=band.wps.getInfo(inx),$scope.wifi.wps.data=band.wps.data(inx),saveBackup(),$scope.wifi.needUpdate=!1,resetStatusChecker()}function saveBackup(){backup.data=device.funcs.deepExtend({},$scope.wifi.wps.data)}function update(){$scope.wifi.wps.data.Enable?apply():apply(action)}function refresh(){var overlay=$scope.overlay.circular,overlayId=overlay.start();shared.activate().then(activate)["finally"](overlay.stop.bind(overlay,overlayId))}function resetStatusChecker(){device.wifi.getBand(0)}function apply(action){saveBackup(),action?shared.apply({action:action,freq:freq}):shared.apply()}var freq=$state.params.freq?$state.params.freq:"2.4GHz",inx=$state.params.inx||"1",currentState=$state.current.name.split("."),action="edit"==currentState.pop()?"wps":void 0,backup={};$scope.wifi.wps={data:null,connectMethod:null,connectStatus:null,info:{},hasWarning:function(name){var band=device.wifi.getBand(0),warnings=band.wps.warnings(inx);return name?_.contains(warnings,name):warnings.length},hasInfoParam:function(param){return $scope.wifi.wps.info?_.has($scope.wifi.wps.info,param):!1},supportParam:function(name){return _.has($scope.wifi.wps.data,name)}},$scope.wifi.isNotModified=function(){return $scope.wifi.wps.data&&backup?angular.equals($scope.wifi.wps.data,backup.data):!0},$scope.wifi.action={apply:apply,update:update,connect:function(){var dlg=ngDialog.open({template:"dialogs/wps_connection/dialog.tpl.html",controller:"WpsConnectionDialogController",resolve:funcs.getLazyResolve("dialogs/wps_connection/ctrl.lazy.js","WpsConnectionDialogController")});dlg.closePromise.then(function(result){if(result&&result.value&&!_.isString(result.value)){var band=device.wifi.getBand(0);_.extend(band.wps.data(inx),{Method:result.value.method,PIN:result.value.pin}),band.wps.connect(inx),apply(action)}})},refresh:refresh,reset:function(){var band=device.wifi.getBand(0);band.wps.reset(update,inx)},unlock:function(){util.unlock(function(response){funcs.is.RPCSuccess(response)||snackbars.add("msg_rpc_write_error"),activate()})},enableRadio:function(){var overlay=$scope.overlay.circular,overlayId=overlay.start();device.wifi.enableRadio(freq,function(){refresh(),overlay.stop(overlayId)})},enableRadioBroadcast:function(){var overlay=$scope.overlay.circular,overlayId=overlay.start();device.wifi.enableRadioBroadcast(freq,inx,function(){refresh(),overlay.stop(overlayId)})}},activate()}])}();