"use strict";!function(){angular.module("app").controllerProvider.register("ChilliRuleCtrl",["$scope","$state","funcs","ChilliUtil",function($scope,$state,funcs,util){function checkUnique(){return helper.checkUnique(chilli.rule.Iface,index)?null:"msg_error_value_is_not_uniq"}function apply(){function success(){$state.go(currentState+".info")}if(!$scope.form.$invalid){var overlay=$scope.overlay.circular,overlayId=overlay.start(),applyObj=helper.applyRule(chilli.rule,index);util.apply(applyObj).then(success)["catch"](function(){$state.go("error",{code:"msg_push_error",message:"msg_error_desc"})})["finally"](overlay.stop.bind(overlay,overlayId))}}$scope.chilliRule={rule:null,__backup:null,LogLevelList:null,IfaceList:null,isActivate:!1,wasModified:function(){return chilli.rule&&chilli.__backup&&!_.isEqual(chilli.__backup,chilli.rule)},checkUnique:checkUnique,checkIP:function(){},checkWalledGarden:function(){var error=[],elems=chilli.rule.UAM.WalledGarden.replace(/\s+/g,"").split(",");return _.each(elems,function(elem){if(!_.isEmpty(elem)){var tmp,tmp2,obj=elem.split(":");obj[1]||error.push("qos_incorrect_value");var patt=/^(?:(?:https?):\/\/)?(?:\S+(?::\S*)?@)?(?:(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4])))|(\[.*\])|(?:(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))))(?::\d{2,5})?(?:\/[^\s]*)?$/i;patt.test(obj[0])?(tmp=obj[0].split("["),tmp[1]&&(tmp2=tmp[1].split("]"),funcs.is.ipv6(tmp2[0])&&"::"!=(funcs.is.ipv6(tmp2[0])&&funcs.ipv6.address["short"](tmp2[0]))||error.push("msg_invalid_url"))):error.push("msg_invalid_url");var patt_number=/(^-?[0-9]+$)/;(_.isEmpty(obj[1])||!patt_number.test(obj[1]))&&error.push("msg_invalid_port_value");var port=parseInt(obj[1]);(0>port||port>65535)&&error.push("msg_invalid_port_value")}}),error.length?error[0]:null},checkURL:function(url){if(!url||""==url)return null;var tmp,tmp2,patt=/^(?:(?:https?):\/\/)(?:\S+(?::\S*)?@)?(?:(?:(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4])))|(\[.*\])|(?:(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))))(?::\d{2,5})?(?:\/[^\s]*)?$/i;return patt.test(url)?(tmp=url.split("["),tmp[1]&&(tmp2=tmp[1].split("]"),!funcs.is.ipv6(tmp2[0])||"::"==(funcs.is.ipv6(tmp2[0])&&funcs.ipv6.address["short"](tmp2[0])))?"msg_invalid_url":null):"msg_invalid_url"},apply:apply,changeEnabled:function(isEnabled){chilli.rule.UAM.NoChallenge=!isEnabled},getLevels:function(){return[{name:"syslog_shared_not_efficient",value:0},{name:"syslog_shared_alert_messages",value:1},{name:"syslog_shared_critical_events",value:2},{name:"syslog_shared_error_messages",value:3},{name:"syslog_shared_different_warnings",value:4},{name:"syslog_shared_important_notifications",value:5},{name:"syslog_shared_info_messages",value:6},{name:"syslog_shared_debugging_messages",value:7}]}};var helper,chilli=$scope.chilliRule,index=_.isUndefined($state.params.inx)?void 0:parseInt($state.params.inx),currentState=$state.current.name.split(".");currentState.pop(),currentState=currentState.join("."),function(){function __activate(){helper=util.makeHelper(),chilli.rule=helper.getRule(index),chilli.authProto=!chilli.rule.UAM.NoChallenge,chilli.__backup=angular.copy(chilli.rule),chilli.LogLevelList=helper.getLogLevelList(),chilli.IfaceList=helper.getIfaceList(),chilli.isActivate=!0,$scope.$emit("pageload")}function errorPull(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})}return util.wasActivate()?void __activate():void util.pull().then(__activate)["catch"](errorPull)}()}])}();