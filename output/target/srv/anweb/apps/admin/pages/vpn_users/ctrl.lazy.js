"use strict";!function(){angular.module("app").controllerProvider.register("vpnUsersCtrl",["$scope","$state","snackbars","ngDialog","vpnUsersUtil","translate",function($scope,$state,snackbars,ngDialog,util,translate){function init(){function finallyCb(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null)}util.pull().then(function(){$scope.vpnUsers.data=util.getConfig(),$scope.vpnUsers.isActivate=!0,$scope.$emit("pageload")})["catch"](function(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})})["finally"](finallyCb)}function openDialog(pos,user){ngDialog.open({template:"/admin/dialogs/vpn_users/dialog.tpl.html",controller:"vpnUsersDialogCtrl",data:{pos:pos,user:user,usedLogin:_.pluck($scope.vpnUsers.data,"Login")},scope:$scope}).closePromise.then(function(data){data&&data.value&&data.value.save&&(overlayId=$scope.overlay.circular.start(),util.apply(data.value.save).then(function(){snackbars.add("msg_rpc_write_success"),init()})["catch"](function(){snackbars.add("msg_rpc_write_error")}))})}$scope.vpnUsers={data:null,isActivate:!1,isShowPassword:!1,add:function(){openDialog(null,{Login:"",Password:""})},edit:function(item,key){openDialog(key,item)},remove:function(items){function error(response){return $scope.overlay.circular.stop(overlayId),"links"==response?void alert(translate("vpn_users_warning_users_links")):void snackbars.add("msg_rpc_remove_error")}overlayId=$scope.overlay.circular.start(),util.removeUsers(items).then(function(){snackbars.add("msg_rpc_remove_success"),init()})["catch"](error)},isEmptyUsers:function(){return 0==$scope.vpnUsers.data.length},hidePass:function(pass){return Array(pass.length+1).join("*")}};var overlayId;init()}])}();