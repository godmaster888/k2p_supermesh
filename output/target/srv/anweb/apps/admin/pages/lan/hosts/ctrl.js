"use strict";!function(){angular.module("app").controller("lanHostsCtrl",["$scope","$state","ngDialog","lanHelper","funcs",function($scope,$state,ngDialog,helper,funcs){function update(){var iface=lan["interface"].getCurrent();iface&&($scope.ipv4&&$scope.ipv4.isActive&&$scope.hosts.update(iface.ipv4.dns),$scope.ipv6&&$scope.ipv6.isActive&&$scope.hosts.update(iface.ipv6.dns))}var lan=$scope.device.lan,supported=$scope.ipv4&&$scope.ipv4.isActive?helper.supported.ipv4():helper.supported.ipv6();$scope.hosts={supported:supported&&supported.DNS,list:{},isEmpty:function(){return this.list&&0==_.size(this.list)},reset:function(){this.list={};var rules=this.util.list();_.each(rules,function(rule,instance){"cut"!=this.util.getInstanceState(instance)&&(this.list[instance]=rule)},this)},update:function(util){this.util=util,this.reset()},onAdd:function(){this.dialog()},onEdit:function(item,instance){var host={ip:item.IPAddress,hostname:item.Hostname,inst:item.__Inst};this.dialog(host,instance)},onDelete:function(items,instances){_.each(instances,function(inst){"add"==this.util.getInstanceState(inst)?this.util.remove(inst):this.util.cut(inst)},this),this.reset()},dialog:function(host,inx){function getIPs(host){var useIps=_.pluck($scope.hosts.list,"IPAddress");return useIps=host?_.without(useIps,host.ip)||[]:useIps,_.map(useIps,function(ip){return $scope.ipv4&&$scope.ipv4.isActive?{IPv4Address:ip}:{IPv6Address:ip}})}var self=this;(function(host){return ngDialog.open({template:"dialogs/dns_hosts/dialog.tpl.html",controller:"DnsHostsDialogCtrl",resolve:funcs.getLazyResolve("dialogs/dns_hosts/ctrl.lazy.js","DnsHostsDialogCtrl"),data:{host:host,version:$scope.ipv4&&$scope.ipv4.isActive?"ipv4":"ipv6",allHostnames:_.pluck($scope.hosts.list,"Hostname"),allIps:getIPs(host),checkStaticAddr:!0},scope:$scope})})(host,inx).closePromise.then(function(dialogData){var hostElem,util=self.util,result=dialogData.value;result&&"save"==result.status&&result.host&&(hostElem={IPAddress:result.host.ip,Hostname:result.host.hostname,__Inst:result.host.inst},host&&$scope.hosts.list[inx]?(util.cut(inx),util.set(hostElem,inx)):util.add(hostElem)),self.reset()})}},update(),$scope.$on("lan.update",update),$scope.$on("lan.interface.update",update)}])}();