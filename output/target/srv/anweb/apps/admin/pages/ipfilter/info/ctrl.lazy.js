"use strict";!function(){angular.module("app").controllerProvider.register("IPFilterInfoCtrl",["$scope","$state","translate","ipfilterUtil",function($scope,$state,translate,util){function activate(){function success(){helper=util.makeHelper(),ipfilter.isActivate=!0,ipfilter.rules=helper.getRules(),$scope.$emit("pageload")}function stopOverlay(){overlayId&&($scope.overlay.circular.stop(overlayId),overlayId=null)}util.pull().then(success)["catch"](function(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})})["finally"](stopOverlay)}function add(){$state.go(currentState+".add")}function edit(item,inx){$state.go(currentState+".edit",{inx:inx,useSchedule:item.useSchedule})}function remove(items,indexes){if(confirm(translate("ipflt_remove_rules_warn"))){overlayId=$scope.overlay.circular.start();var removeList=helper.makeRemoveList(indexes);util.removeRules(removeList).then(activate)["catch"](function(){$state.go("error",{code:"removeError",message:"removeErrorDesc"})})}}function getSource(item){return getRange(item,"ips","ports")}function getDestination(item){return getRange(item,"ipd","portd")}function getRange(item,ipField,portField){var ip=""!=item[ipField]&&"0.0.0.0/0"!=item[ipField]?item[ipField]:translate("all"),port=item[portField]||translate("all"),arrIp=ip.split("-"),strIp=arrIp.join(" - ");return"["+strIp+"] : ["+port+"]"}function escapeHtml(str){var escapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};if(_.isString(str))return str.replace(/<|>/g,function(s){return escapes[s]})}function isSupported(param){return helper?helper.isSupported(param):void 0}$scope.ipfilter={isActivate:!1,rules:null,add:add,edit:edit,remove:remove,getSource:getSource,getDestination:getDestination,getSourceDestination:function(item){function formIPv6SourceDestination(item){function getIpv6Str(ipv6,param){if(ipv6){var result="";result+="<span>[</span>";var arrIPv6=ipv6.split("-");return"source"==param&&($scope.ipsource=arrIPv6,result+="<span ipv6cut='ipsource[0]'></span>",$scope.ipsource[1]&&(result+="<span> - </span>",result+="<span ipv6cut='ipsource[1]'></span>")),"dest"==param&&($scope.ipdest=arrIPv6,result+="<span ipv6cut='ipdest[0]'></span>",$scope.ipdest[1]&&(result+="<span> - </span>",result+="<span ipv6cut='ipdest[1]'></span>")),result+="<span>]</span>"}}var ipsstr=item.ips&&""!=item.ips&&"0.0.0.0/0"!=item.ips?getIpv6Str(item.ips,"source"):"<span>["+escapeHtml(translate("all"))+"]</span>",ports=item.ports||escapeHtml(translate("all")),ipdstr=item.ipd&&""!=item.ipd&&"0.0.0.0/0"!=item.ipd?getIpv6Str(item.ipd,"dest"):"<span>["+escapeHtml(translate("all"))+"]</span>",portd=item.portd||escapeHtml(translate("all")),resultStr="";return resultStr=resultStr+"<div class='not_break_block'>"+ipsstr+" : ["+ports+"]</div>",resultStr+="<div> - </div>",resultStr=resultStr+"<div class='not_break_block'>"+ipdstr+" : ["+portd+"]</div>"}return item.is_ipv6?formIPv6SourceDestination(item):getRange(item,"ips","ports")+" - "+getRange(item,"ipd","portd")},getMiniCaption:function(item){return _.has(item,"name")?item.name:_.has(item,"id")?translate("rule")+" â„–"+item.id:void 0},getMiniInfo:function(item){var info=[];return info.push(translate("protocol")+": "+item.proto),info.push(translate("ip_version")+": "+item.IPVersion),info.push(translate("source")+": "+getSource(item)),info.push(translate("dest")+": "+getDestination(item)),info.push("act_allow"==item.action?translate("action")+": "+translate("act_allow"):translate("action")+": "+translate("act_deny")),info.push(item.state?translate("state")+": "+translate("st_enabled"):translate("state")+": "+translate("st_disabled")),info},isSupported:isSupported,isEmptyRules:function(){return!ipfilter.rules||0==ipfilter.rules.length}};var helper,overlayId=null,ipfilter=$scope.ipfilter;activate();var currentState=$state.current.name.split(".");currentState.pop(),currentState=currentState.join(".")}])}();