"use strict";!function(){angular.module("app").controllerProvider.register("VserversInfoCtrl",["$scope","$state","translate","vserversUtil",function($scope,$state,translate,util){function activate(overlayId){function success(){helper=util.makeHelper(),vservers.config=util.getConfig(),vservers.intefracesEmpty=helper.getEmptyIfaces(vservers.config.Rules)}util.pull().then(success)["catch"](function(){$state.go("error",{code:"msg_pull_error",message:"msg_error_desc"})})["finally"](function(){overlayId&&overlay.stop(overlayId),$scope.$emit("pageload"),vservers.isActivate=!0})}function add(){$state.go(currentState+".add")}function edit(item){$state.go(currentState+".edit",{inx:item.__id})}function getNATLoopbackStatus(snat){return translate(snat?"st_enabled":"st_disabled")}$scope.vservers={isActivate:!1,config:null,intefracesEmpty:null,activate:activate,add:add,edit:edit,remove:function(items){if(confirm(translate("vservers_rules_remove_warning"))){var overlayId=overlay.start();util.removeRules(items).then(function(){activate()})["catch"](function(){$state.go("error",{code:"removeError",message:"removeErrorDesc"})})["finally"](function(){overlay.stop(overlayId)})}},isEmptyRules:function(){return!vservers.config||!vservers.config.Rules||0==vservers.config.Rules.length},getIP:function(ips){return ips.length&&""!=ips[0]?ips[0]:translate("all")},getIfaceName:function(iface){if("all"==iface)return translate("all");var result=_.find(vservers.config.Ifaces,function(e){return e.Value==iface});return result?result.Name:""},getMiniInfo:function(item){var info=[],iface=translate(item.Source.Iface);return info.push(translate("iface")+": "+iface),info.push(translate("protocol")+": "+item.Proto),info.push(translate("source")+": "+item.Source.IP+":"+item.Source.Ports[1].Start+":"+item.Source.Ports[1].End),info.push(translate("dest")+": "+item.Dest.IP+":"+item.Dest.Ports[1].Start+":"+item.Dest.Ports[1].End),info.push(translate("vservers_nat_loopback")+": "+getNATLoopbackStatus(item.SNAT)),info},joinPorts:function(input){var ports=[];return _.each(input,function(elem){var str="";elem.Start&&(str+=elem.Start),str+=elem.End&&"ftp"!=elem.Type?":"+elem.End:elem.End,ports.push(str)}),ports.join(",")},getNATLoopbackStatus:getNATLoopbackStatus};var helper,vservers=$scope.vservers,overlay=$scope.overlay.circular,currentState=$state.current.name.split(".");currentState.pop(),currentState=currentState.join("."),$scope.tableTitle="vservers_desc",$scope.emptyRulesDesc="vservers_rules_empty",activate()}])}();